<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LOZEE 시작하기</title>
    <!-- ─────────── 수정 전 ─────────── -->
    <!--
    <link
        href="https://fonts.googleapis.com/css2?family=KoPub+World+Dotum:wght@400;700&display=swap"  응 이게 그때 index야.  
        rel="stylesheet"
    />
    -->
    <!-- ─────────── 수정 후 ─────────── -->
    <link
        href="https://fonts.googleapis.com/css2?family=KoPub+World+Dotum:wght@400;700&display=swap"
        rel="stylesheet"
    /> <!-- ★수정됨★ -->

    <style>
        /* ...이하 스타일은 원본 그대로 생략... */
    </style>
</head>
<body class="step-background-main">
    <!-- ...스텝 1~3까지 원본 그대로... -->

    <script type="module">
        import { counselingTopicsByAge } from './js/counseling_topics.js';
        import { validateCbtEmail, getCbtErrorMessage } from './js/cbt.js';  <!-- ★수정됨★ -->

        // DOM 요소 참조
        const stepCBT   = document.getElementById('stepCBT');
        const stepNameAge   = document.getElementById('stepNameAge');
        const stepDiagnosis = document.getElementById('stepDiagnosis');
        const stepLozeeIntro= document.getElementById('stepLozeeIntro');
        const stepTopic     = document.getElementById('stepTopic');
        // ...이하 생략...

        function proceedToNextStep(errElem, ttsText, nextIdx){
            if(errElem) errElem.textContent = '';
            playTTS(ttsText);
            showStep(nextIdx);
        }

        // ─────────── 3단계 진단 → 4단계 주제 선택 이어주기 ───────────
        submitDiagnosisBtn.onclick = () => {
            const selected = Array.from(
                diagnosisSelection.querySelectorAll('button.selected')
            ).map(b=>b.dataset.id);
            localStorage.setItem('lozee_userdisease', JSON.stringify(selected));

            const userAge = parseInt(localStorage.getItem('lozee_userage'), 10);
            const targetDiagnoses = ['adhd','asd','asperger','social_comm_disorder','2e'];
            const hasSpecificDiagnosis = selected.some(id =>
                targetDiagnoses.includes(id.toLowerCase())
            );

            if (hasSpecificDiagnosis) {
                // ─── 진단 있으면 바로 4단계(stepTopic)로 이동
                if (topicUserAgeInfo) topicUserAgeInfo.textContent = `${userAge}세`;
                renderTopicCategories(userAge);
                proceedToNextStep(
                    diagnosisError,
                    '네, 알겠습니다. 어떤 종류의 이야기를 하고 싶으세요? 마음이 가는 이야기를 골라보세요.',
                    steps.indexOf(stepTopic)  // ★수정됨★
                );
            } else {
                // ─── 진단 없으면 3-1단계(stepLozeeIntro)로
                proceedToNextStep(
                    diagnosisError,
                    '로지에 대해 잠시 안내해 드릴게요.',
                    steps.indexOf(stepLozeeIntro)
                );
            }
        };
        // ────────────────────────────────────────────────────────────────

        // ...나머지 스크립트 원본 그대로 유지...
    </script>
</body>
</html>
