<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOZEE 시작하기</title>
    <link href="https://fonts.googleapis.com/css2?family=KoPub+World+Dotum:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* 기본 스타일 */
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'KoPub World Dotum', sans-serif;
            color: #333;
            height: 100%;
            overflow: hidden;
        }

        .step {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            color: white;
        }

        .step.active {
            display: flex;
        }

        .step-background-main {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
        }
        .step-background-main input,
        .step-background-main select,
        .step-background-main textarea {
            color: #333;
        }
        .step-background-main .error-message {
            color: #ffdddd;
        }
        .step-background-main .info-text {
            color: #e0e0e0;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        p {
            margin-bottom: 15px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        input[type="text"],
        select,
        textarea {
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 85%;
            max-width: 350px;
            box-sizing: border-box;
            font-size: 1em;
        }

        textarea {
            height: 120px;
            resize: none;
        }

        button {
            padding: 12px 25px;
            background-color: #ffffff;
            color: #6e8efb;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
            margin-top: 15px;
            font-weight: bold;
            font-size: 1em;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: #f0f0f0;
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0px);
        }

        button:disabled {
            background-color: #ccc;
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .error-message {
            color: #ffdddd;
            font-size: 0.9em;
            min-height: 1.2em;
            margin-top: -5px;
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .topic-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            max-width: 400px;
        }

        .topic-options button, button.secondary-button {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.5);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.95em;
        }

        .topic-options button.selected, .topic-options button:hover, button.secondary-button:hover {
            background-color: white;
            color: #6e8efb;
            border-color: white;
        }
        
        button.secondary-button { /* "해당사항 없음" 버튼 스타일 */
            margin-top: 5px;
            background-color: transparent;
            border: 1px solid white;
        }
        button.secondary-button.hidden { /* "해당사항 없음" 버튼 숨김 처리 */
            display: none;
        }


        .loading-indicator {
            display: none;
            font-size: 0.9em;
            margin-top: 5px;
            color: white;
        }
        
        #customTopicContainer {
            background-color: rgba(0,0,0,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        #customTopicContainer p {
            font-size: 1em;
            margin-bottom: 10px;
        }

        @media (max-width: 600px) {
            h2 { font-size: 1.5em; }
            p { font-size: 1em; }
            input[type="text"],
            select,
            textarea {
                width: 90%;
                padding: 10px;
            }
            button { padding: 10px 20px; font-size: 0.95em;}
            .topic-options button, button.secondary-button {
                padding: 8px 12px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body id="introBody" class="step-background-main"> 
    <div id="stepCBT" class="step">
        <h2>로지와 대화 시작하기</h2>
        <p>CBT 코드를 입력해주세요.</p>
        <input type="text" id="cbtCodeInput" placeholder="CBT 코드">
        <div class="error-message" id="cbtCodeError"></div>
        <button id="submitCbtCodeBtn">다음</button>
    </div>

    <div id="stepName" class="step">
        <h2>만나서 반가워요!</h2>
        <p>로지가 당신을 어떻게 부르면 좋을까요?</p>
        <input type="text" id="nameInput" placeholder="이름 또는 별명">
        <div class="error-message" id="nameError"></div>
        <button id="submitNameBtn">다음</button>
    </div>
    
    <div id="stepAge" class="step">
        <h2>나이를 알려주세요.</h2>
        <p class="info-text">로지와 깊이 있는 대화를 나누기 위해서는 나이 정보가 중요해요.<br>실제 나이를 선택해주세요.</p>
        <select id="ageSelectInput">
            <option value="">나이를 선택해주세요</option>
        </select>
        <div class="error-message" id="ageError"></div>
        <button id="submitAgeBtn">다음</button>
    </div>

    <div id="stepTopic" class="step">
        <h2>어떤 이야기를 나누고 싶으세요?</h2>
        <p><span id="topicUserAgeInfo"></span> 사용자를 위한 추천 주제입니다.<br>원하시는 주제를 선택해주세요.</p>
        <div id="topicSelection" class="topic-options"></div>
        <button id="noTopicBtn" class="secondary-button hidden">해당사항 없음</button>
        <div id="customTopicContainer" style="display: none; width: 85%; max-width: 350px;">
            <p>어떤 주제로 이야기하고 싶으신지 직접 입력해주세요:</p>
            <textarea id="customTopicInput" placeholder="예: 최근에 겪은 일, 고민거리 등"></textarea>
            <div class="error-message" id="customTopicError"></div>
            <button id="submitCustomTopicBtn">이 주제로 시작</button>
        </div>
        <div class="error-message" id="topicOverallError"></div>
    </div>

    <div id="stepVoice" class="step">
