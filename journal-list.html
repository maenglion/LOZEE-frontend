<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="pageTabTitle">ì´ì•¼ê¸° ëª¨ìŒì§‘ - LOZEE</title>
    <link href="https://fonts.googleapis.com/css2?family=KoPub+World+Dotum:wght@400;700&display=swap" rel="stylesheet"/> 
    <link rel="stylesheet" href="gnb.css">
    <link rel="stylesheet" href="css/common.css"> 
    <style>
    /* journal-list.html ê³ ìœ  ìŠ¤íƒ€ì¼ */
    :root {
        --primary-color: #6e8efb;
        --secondary-color: #5a7edf;
        --background-color: #f4f6f8;
        --text-color: #333333;
        --card-bg: #ffffff;
        --yellow-highlight: #fff9c4; 
        --blue-button-bg: #6e8efb; /* ë²„íŠ¼ ë°°ê²½ìƒ‰ ì¼ê´€ì„± */
        --blue-button-hover-bg: #5a7edf; /* ë²„íŠ¼ í˜¸ë²„ ìƒ‰ ì¼ê´€ì„± */
    }

    /* body ìŠ¤íƒ€ì¼ì€ gnb.cssì—ì„œ ì´ë¯¸ padding-topê³¼ font-familyë¥¼ ì„¤ì •í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
       ë§Œì•½ gnb.cssì— body ìŠ¤íƒ€ì¼ì´ ì—†ë‹¤ë©´ ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ê³  ì‚¬ìš©í•˜ì„¸ìš”.
       ë˜ëŠ”, ì´ í˜ì´ì§€ì—ì„œë§Œ íŠ¹ë³„íˆ ë‹¤ë¥¸ body ë°°ê²½ì´ë‚˜ ê¸€ììƒ‰ì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ì—¬ê¸°ì— ì •ì˜í•©ë‹ˆë‹¤. */
    body {
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
    }

    .container {
        max-width: 1100px;
        margin: 20px auto; /* GNB ì•„ë˜ë¶€í„°ì˜ ìƒë‹¨ ì—¬ë°± */
        padding: 20px;
        box-sizing: border-box;
    }

    .page-title {
        color: var(--primary-color);
        text-align: center;
        font-size: 2em; 
        margin-bottom: 30px; 
        font-weight: 700;
    }

    .main-tags-area {
        background-color: var(--card-bg);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 30px;
        text-align: center;
    }

    .main-tags-area h2 {
        font-size: 1.2em;
        color: var(--primary-color);
        margin-top: 0;
        margin-bottom: 15px;
        border-bottom: none;
    }

    .tag-button-list {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }

    .tag-filter-btn {
        padding: 8px 15px;
        background-color: #e8eaf6; 
        color: #3f51b5;
        border: none;
        border-radius: 20px; 
        cursor: pointer;
        font-size: 0.95em;
        font-weight: 500;
        transition: background-color 0.2s, transform 0.1s;
    }

    .tag-filter-btn:hover {
        background-color: #c5cae9;
        transform: translateY(-1px);
    }

    .tag-filter-btn.active { 
        background-color: var(--primary-color);
        color: white;
        font-weight: bold;
    }

    .topic-summary-card-list {
    display: grid;
    gap: 25px;
    margin-bottom: 30px; /* í˜ì´ì§€ë„¤ì´ì…˜ê³¼ì˜ ê°„ê²© */
    grid-template-columns: 1fr; /* âœ… ì´ ì¤„ì„ ì¶”ê°€í•˜ì—¬ í•­ìƒ í•œ ì¤„ì— ì¹´ë“œ 1ê°œë§Œ í‘œì‹œ */
}

    .topic-summary-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0,0,0,0.12);
    }

    .topic-main-title { /* ì˜ˆ: í•™êµìƒí™œ ì´ì•¼ê¸° */
        font-size: 1.4em;
        font-weight: bold;
        color: var(--primary-color);
        margin-top: 0; /* h2, h3 ë“± ì œëª© íƒœê·¸ ì‚¬ìš© ì‹œ ê¸°ë³¸ ë§ˆì§„ ì œê±° */
        margin-bottom: 5px;
    }
    .topic-sub-title { /* ì˜ˆ: "ì™œ ë‚˜ëŠ” ì¹œêµ¬ê°€ ì—†ì„ê¹Œ?" */
        font-size: 1.1em;
        color: var(--text-color);
        margin-top: 0;
        margin-bottom: 15px;
        font-weight: 500;
    }
    .topic-meta-info {
        display: flex;
        flex-wrap: wrap; /* ì‘ì€ í™”ë©´ì—ì„œ ì¤„ë°”ê¿ˆë˜ë„ë¡ */
        gap: 10px;
        margin-bottom: 15px;
        font-size: 0.9em; /* ë©”íƒ€ ì •ë³´ í°íŠ¸ ì•½ê°„ ì‘ê²Œ */
    }
    .meta-item {
        background-color: var(--yellow-highlight);
        color: #5d4037; /* ì–´ë‘ìš´ ê°ˆìƒ‰ ê³„ì—´ */
        padding: 5px 12px;
        border-radius: 15px;
        font-weight: 500;
    }
    
    .journal-summary-preview { /* ì¹´ë“œ ë‚´ì˜ ì§§ì€ ìš”ì•½ (ì´ì „ì—ëŠ” topic-overall-assessment) */
        font-size: 0.95em;
        color: #555; /* ì´í‰ë³´ë‹¤ ì•½ê°„ ë°ê²Œ */
        background-color: #f9f9f9; /* ì•½ê°„ì˜ ë°°ê²½ êµ¬ë¶„ */
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px; /* ë¶„ì„ ë°°ë„ˆì™€ì˜ ê°„ê²© */
        line-height: 1.7;
        flex-grow: 1; /* ë‚¨ì€ ê³µê°„ ì±„ìš°ë„ë¡ */
        display: -webkit-box;
        -webkit-line-clamp: 3; 
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        min-height: calc(0.95em * 1.7 * 3); /* ëŒ€ëµì ì¸ 3ì¤„ ë†’ì´ */
    }
    .journal-analysis-banner { 
        padding: 8px 12px; 
        border-radius: 6px; 
        margin-bottom: 15px; /* ë²„íŠ¼ê³¼ì˜ ê°„ê²© */
        font-size: 0.9em; 
        text-align: center;
    }
    .journal-analysis-banner.positive { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9;}
    .journal-analysis-banner.neutral { background-color: #eceff1; color: #37474f; border: 1px solid #cfd8dc;}
    .journal-analysis-banner.negative { background-color: #ffebee; color: #c62828; border: 1px solid #ffcdd2;}

    .view-sessions-button { 
        display: inline-block; 
        background-color: var(--blue-button-bg); 
        color: white; 
        padding: 10px 20px; 
        border: none; 
        border-radius: 20px; 
        text-decoration: none; 
        font-weight: bold; 
        font-size: 0.95em; 
        transition: background-color 0.2s; 
        margin-top: auto; /* ì¹´ë“œ í•˜ë‹¨ ì •ë ¬ */ 
        align-self: flex-start; 
    }
    .view-sessions-button:hover { 
        background-color: var(--blue-button-hover-bg); 
    }

    .pagination { /* í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
        display: flex;
        justify-content: center;
        gap: 12px;
        font-size: 1em;
        margin-top: 30px;
        padding-bottom: 20px; /* í•˜ë‹¨ ì—¬ë°± */
    }
    .pagination a {
        text-decoration: none;
        color: var(--primary-color);
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 4px;
        transition: background-color 0.2s, color 0.2s;
    }
    .pagination a:hover {
        background-color: var(--secondary-color);
        color: white;
    }
    .pagination .current {
        color: var(--text-color);
        background-color: #e0e0e0;
    }

    /* ë°˜ì‘í˜• ì¹´ë“œ ë ˆì´ì•„ì›ƒ */
    /*
    @media (min-width: 1024px) { .topic-summary-card-list { grid-template-columns: repeat(3, 1fr); } }
    @media (min-width: 601px) and (max-width: 1023px) { .topic-summary-card-list { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 600px) { .topic-summary-card-list { grid-template-columns: 1fr; } }*/
</style>
</head>
<body>
 <div class="app-container">
        <nav id="gnb">
            <button id="menu-toggle">â˜°</button>
            <div id="gnb-title">LOZEE</div>
            <div style="width: 44px;"></div> 
            <div id="dropdown-menu">
                <a href="mypage.html">ğŸ¨ ë‚´ ì •ë³´ ë³´ê¸°</a>
                <a href="index.html">âœ¨ ìƒˆë¡œìš´ ì´ì•¼ê¸° ì‹œì‘!</a>
                <a id="gnb-analysis-link" href="analysis.html">ğŸ“Š ìš°ë¦¬ ì´ì•¼ê¸° ë¶„ì„</a>
                <a href="journal-list.html">ğŸ“– ì´ì•¼ê¸° ëª¨ìŒì§‘</a>
                <a href="https://www.notion.so/maenglionworld/lOZEE-1ebbcdc037cd80fa9c0ddef234121e84?pvs=4" target="_blank">â“ ë¡œì§€ ì‚¬ìš© ì„¤ëª…ì„œ</a>
            </div>
        </nav>
    <main class="container">
        <h1 id="pageMainTitle" class="page-title">ë‚˜ì˜ ì´ì•¼ê¸° ëª¨ìŒì§‘ ğŸ“–</h1>

        <div class="main-tags-area">
            <h2>âœ¨ ë‚˜ì˜ ì£¼ìš” ì´ì•¼ê¸° íƒœê·¸ âœ¨</h2>
            <div id="mainTagButtons" class="tag-button-list">
                </div>
        </div>

        <div class="topic-summary-card-list" id="topicCardList">
            </div>

        <div class="pagination" style="display:none;"> 
            </div>
    </main>

      <script type="module">
        import { db } from './js/firebase-config.js';
        import { collection, query, where, getDocs, orderBy, doc, getDoc, limit } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';

        const topicCardListEl = document.getElementById('topicCardList');
        const pageMainTitleEl = document.getElementById('pageMainTitle');
        const pageTabTitleEl = document.querySelector('title');
        const mainTagButtonsEl = document.getElementById('mainTagButtons');

        const userName = localStorage.getItem('lozee_username') || 'ë‚˜';
        if (pageMainTitleEl) pageMainTitleEl.textContent = `${userName}ì˜ ì´ì•¼ê¸° ëª¨ìŒì§‘ ğŸ“–`;
        if (pageTabTitleEl) pageTabTitleEl.textContent = `${userName}ì˜ ì´ì•¼ê¸° ëª¨ìŒì§‘ - LOZEE`;

        let allUserTopicStats = []; 
        let currentFilterTag = 'ì „ì²´ë³´ê¸°';

        // --- ì˜ˆì‹œ ë°ì´í„° í‘œì‹œ í•¨ìˆ˜ (ìš”ì²­ì‚¬í•­ ë°˜ì˜) ---
        function displaySampleJournalTopicCards() {
            if (!topicCardListEl) return;
            topicCardListEl.innerHTML = ''; 
            
            const sampleTopics = [
                {
                    id: "family_conflict_pattern", // Firestore ë¬¸ì„œ IDê°€ ë  ì£¼ì œëª… (ì˜ˆì‹œ)
                    topicDisplayName: "ê°€ì¡± ê´€ê³„ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", // ëŒ€ì£¼ì œ
                    latestSubTopicTitle: "ë°˜ë³µë˜ëŠ” ê°€ì¡± íŒ¨í„´ê³¼ ë‚˜ì˜ ëŒ€ì²˜", // ë¡œì§€ê°€ ìš”ì•½í•œ ì œëª©
                    lastChattedAt: { toDate: () => new Date() }, // ì˜¤ëŠ˜ ë‚ ì§œ
                    count: 1, // ì´ë²ˆ ëŒ€í™”ê°€ 1íšŒì°¨ë¼ê³  ê°€ì •
                    // ì‚¬ìš©ìì™€ ë¡œì§€ì˜ ëŒ€í™” ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì´í‰
                    overallAssessment: "ê°€ì¡± ë‚´ì—ì„œ ë°˜ë³µë˜ëŠ” íŠ¹ì • í–‰ë™ íŒ¨í„´ê³¼ ê·¸ì— ëŒ€í•œ ë¼ì´ì–¸ë‹˜ì˜ ëª…í™•í•œ ë¶„ì„, ê·¸ë¦¬ê³  ì§ë©´ ëŒ€ì‘ ë°©ì‹ì— ëŒ€í•œ ê¹Šì´ ìˆëŠ” ëŒ€í™”ì˜€ì–´ìš”. ìì‹ ì˜ íŠ¹ì„±ì„ ì´í•´í•˜ê³  ê´€ê³„ë¥¼ ì£¼ì²´ì ìœ¼ë¡œ ê´€ë¦¬í•˜ë ¤ëŠ” ëª¨ìŠµì´ ì¸ìƒì ì´ë„¤ìš”.",
                    // ëŒ€í™” ë‚´ìš© ê¸°ë°˜ í‚¤ì›Œë“œ
                    keywords: ["ê°€ì¡±", "íŒ¨í„´", "íšŒí”¼", "ì§ë©´ëŒ€ì‘", "ì•„ìŠ¤í¼ê±°", "ADHD", "ê¸°ì–µë ¥", "íŒë‹¨", "ë‚´ë¡œë‚¨ë¶ˆ"],
                    sentimentExample: "neutral" // ë˜ëŠ” ëŒ€í™”ì˜ ì „ë°˜ì  ëŠë‚Œ
                },
                {
                    topicDisplayName: "í•™êµìƒí™œ ì´ì•¼ê¸° ğŸ’",
                    latestSubTopicTitle: "ìƒˆ í•™ê¸°, ìƒˆë¡œìš´ ì¹œêµ¬ë“¤",
                    lastChattedAt: { toDate: () => new Date(Date.now() - 86400000 * 3) }, // 3ì¼ ì „
                    count: 3,
                    overallAssessment: "ìƒˆ í•™ë…„ì´ ë˜ì–´ ìƒˆë¡œìš´ ì¹œêµ¬ë“¤ì„ ì‚¬ê·€ëŠ” ê²ƒì— ëŒ€í•œ ê¸°ëŒ€ì™€ ì•½ê°„ì˜ ê¸´ì¥ê°ì´ ëŠê»´ì§€ëŠ” ëŒ€í™”ì˜€ì–´ìš”. ë¡œì§€ê°€ ì‘ì›í• ê²Œìš”!",
                    keywords: ["í•™êµ", "ìƒˆí•™ê¸°", "ì¹œêµ¬", "ê¸°ëŒ€", "ê¸´ì¥"],
                    sentimentExample: "positive"
                }
            ];

            if (mainTagButtonsEl) {
                const sampleKeywordsForTags = sampleTopics.reduce((acc, curr) => {
                    if(curr.keywords) acc.push(...curr.keywords);
                    return acc;
                }, []);
                const uniqueSampleKeywords = [...new Set(sampleKeywordsForTags)];
                const journalsForSampleTags = uniqueSampleKeywords.map(kw => ({id: kw, keywords: [kw]})); 
                displayMainTags(journalsForSampleTags); 
            }


            sampleTopics.forEach(topicData => {
                // createTopicSummaryCard í•¨ìˆ˜ëŠ” topicData.id (ì£¼ì œëª…/ë¬¸ì„œ ID)ì™€ topicData ìì²´ë¥¼ ë°›ìŒ
                const card = createTopicSummaryCard(topicData.id, topicData); 
                topicCardListEl.appendChild(card);
            });
            updateTagButtonStates(); 
        }
        
        // --- ì£¼ì œë³„ ìš”ì•½ ì¹´ë“œ ìƒì„± í•¨ìˆ˜ ---
        function createTopicSummaryCard(topicName, statData) { // topicNameì€ Firestore ë¬¸ì„œ ID (ì£¼ì œëª…)
            const card = document.createElement('div');
            card.className = 'topic-summary-card';

            const mainTitle = statData.topicDisplayName || topicName; // topicDisplayNameì´ ìš°ì„ 
            const subTitle = statData.latestSubTopicTitle || `"${mainTitle}"ì— ëŒ€í•œ ì´ì•¼ê¸°`; 
            const lastChattedDate = statData.lastChattedAt?.toDate 
                ? statData.lastChattedAt.toDate().toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric'}) 
                : 'ì•Œ ìˆ˜ ì—†ìŒ';
            const sessionCount = statData.count || 0;
            const assessment = statData.overallAssessment || `ì´ ì£¼ì œë¡œ ${sessionCount}ë²ˆ ì´ì•¼ê¸°í–ˆì–´ìš”.`;
            
            let analysisBannerHTML = '';
            if (statData.sentimentExample) {
                 let bannerClass = 'neutral';
                 if (statData.sentimentExample === 'positive') bannerClass = 'positive';
                 else if (statData.sentimentExample === 'negative') bannerClass = 'negative';
                 analysisBannerHTML = `<div class="journal-analysis-banner ${bannerClass}">âœ¨ ë¡œì§€ ìƒê°: ${statData.sentimentExample} ëŠë‚Œì˜ ëŒ€í™”ì˜€ì–´ìš”!</div>`;
            }

            card.innerHTML = `
                <div class="topic-main-title">${mainTitle}</div>
                <div class="topic-sub-title">${subTitle}</div>
                <div class="topic-meta-info">
                    <span class="meta-item">ë§ˆì§€ë§‰ ì´ì•¼ê¸°: ${lastChattedDate}</span>
                    <span class="meta-item">ì´ ì´ì•¼ê¸°: ${sessionCount}íšŒ</span>
                </div>
                <p class="journal-summary-preview">${assessment}</p> 
                ${analysisBannerHTML}
                <a href="journal-list2.html?topic=${encodeURIComponent(topicName)}" class="view-sessions-button">${sessionCount > 0 ? sessionCount : 'ì´ì•¼ê¸°'} ìì„¸íˆ ë³´ê¸°</a>
            `;
            return card;
        }

        // --- ìì£¼ ì‚¬ìš©ëœ íƒœê·¸ ë²„íŠ¼ í‘œì‹œ í•¨ìˆ˜ ---
        function displayMainTags(statsForTagExtraction) { // ì´ì œ topicStats ë°°ì—´ì„ ì¸ìë¡œ ë°›ìŒ
            if (!mainTagButtonsEl) return;
            mainTagButtonsEl.innerHTML = ''; 

            const tagCounts = {};
            statsForTagExtraction.forEach(stat => { // statì€ {id:"ì£¼ì œëª…", keywords:["íƒœê·¸1", "íƒœê·¸2"], ...} í˜•íƒœ
                if (stat.keywords && Array.isArray(stat.keywords)) {
                    stat.keywords.forEach(tag => {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    });
                }
            });

            const sortedTags = Object.entries(tagCounts)
                .sort(([,a],[,b]) => b-a).slice(0, 5).map(([tag]) => tag);

            const allViewBtn = document.createElement('button');
            allViewBtn.className = 'tag-filter-btn active'; 
            allViewBtn.textContent = 'âœ¨ ì „ì²´ ì´ì•¼ê¸°';
            allViewBtn.dataset.tag = 'ì „ì²´ë³´ê¸°'; 
            allViewBtn.onclick = () => { currentFilterTag = 'ì „ì²´ë³´ê¸°'; renderFilteredTopicCards(); updateTagButtonStates(); };
            mainTagButtonsEl.appendChild(allViewBtn);

            sortedTags.forEach(tag => {
                const button = document.createElement('button');
                button.className = 'tag-filter-btn';
                button.textContent = `#${tag}`;
                button.dataset.tag = tag;
                button.onclick = () => { currentFilterTag = tag; renderFilteredTopicCards(); updateTagButtonStates();};
                mainTagButtonsEl.appendChild(button);
            });
        }

        function updateTagButtonStates() { 
            if (!mainTagButtonsEl) return;
            const buttons = mainTagButtonsEl.querySelectorAll('.tag-filter-btn');
            buttons.forEach(btn => {
                if (btn.dataset.tag === currentFilterTag) { btn.classList.add('active'); } 
                else { btn.classList.remove('active'); }
            });
        }
        
        // --- í•„í„°ë§ëœ ì£¼ì œ ìš”ì•½ ì¹´ë“œë¥¼ í™”ë©´ì— ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜ ---
        function renderFilteredTopicCards() {
            if (!topicCardListEl) return;
            topicCardListEl.innerHTML = ''; 

            const topicsToDisplay = currentFilterTag && currentFilterTag !== 'ì „ì²´ë³´ê¸°'
                ? allUserTopicStats.filter(stat => stat.keywords && stat.keywords.includes(currentFilterTag))
                : allUserTopicStats;

            if (topicsToDisplay.length === 0) {
                topicCardListEl.innerHTML = currentFilterTag && currentFilterTag !== 'ì „ì²´ë³´ê¸°'
                    ? `<p style="text-align:center;">'#${currentFilterTag}' íƒœê·¸ê°€ í¬í•¨ëœ ì£¼ì œì˜ ì´ì•¼ê¸°ê°€ ì•„ì§ ì—†ì–´ìš”. ğŸ§</p>`
                    : '<p style="text-align:center;">ì•„ì§ ë¡œì§€ë‘ ë‚˜ëˆˆ ì´ì•¼ê¸°ê°€ ì—†ëŠ” ê²ƒ ê°™ì•„ìš”. ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³¼ê¹Œìš”? ğŸ˜Š</p>';
                return;
            }
            
            topicsToDisplay.forEach(topicStatData => {
                const card = createTopicSummaryCard(topicStatData.id, topicStatData); 
                topicCardListEl.appendChild(card);
            });
        }

        // --- Firestoreì—ì„œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ ---
async function loadInitialPageData() {
    const userId = localStorage.getItem('lozee_userId'); //
    if (!userId) { //
        if(pageMainTitleEl) pageMainTitleEl.textContent = `${localStorage.getItem('lozee_username') || 'ë‚˜'}ì˜ ì´ì•¼ê¸° ëª¨ìŒì§‘ ğŸ“– (ì˜ˆì‹œ)`; //
        console.log("ì‚¬ìš©ì ID ì—†ìŒ, ì˜ˆì‹œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤."); //
        // displaySampleJournalTopicCards(); // âœ… ì´ ë¶€ë¶„ì„ ì£¼ì„ ì²˜ë¦¬
        return; //
    }

    try { //
        const statsQuery = query(collection(db, `users/${userId}/topicStats`), orderBy('lastChattedAt', 'desc')); //
        const statsSnapshot = await getDocs(statsQuery); //

        if (statsSnapshot.empty) { //
            console.log("Firestoreì— topicStats ë°ì´í„° ì—†ìŒ, ì˜ˆì‹œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤."); //
            if(mainTagButtonsEl) mainTagButtonsEl.innerHTML = '<p>ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©´ ìì£¼ ë‚˜ì˜¨ ë§ˆìŒ ì¡°ê°ë“¤ì„ ì—¬ê¸°ì„œ ë³¼ ìˆ˜ ìˆì–´ìš”!</p>'; //
            // displaySampleJournalTopicCards(); // âœ… ì´ ë¶€ë¶„ì„ ì£¼ì„ ì²˜ë¦¬
            return; //
        }

        allUserTopicStats = statsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); //
        allUserTopicStats.forEach(stat => { if (!stat.keywords) stat.keywords = []; }); //

        displayMainTags(allUserTopicStats); //
        currentFilterTag = 'ì „ì²´ë³´ê¸°'; //
        renderFilteredTopicCards(); //

    } catch (error) { //
        console.error("ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", error); //
        if(topicCardListEl) topicCardListEl.innerHTML = '<p>ì´ì•¼ê¸° ëª¨ìŒì§‘ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”. ğŸ˜­ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>'; //
        console.log("ì˜¤ë¥˜ ë°œìƒ, ì˜ˆì‹œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤."); //
        // displaySampleJournalTopicCards(); // âœ… ì´ ë¶€ë¶„ì„ ì£¼ì„ ì²˜ë¦¬
    }
}
             
        
async function renderJournalsForParent(parentId) {
  const q = query(
    collection(db, "journals"),
    where("ownerId", "==", parentId),
    where("entryType", "==", "standard"), // "child"ëŠ” ì œì™¸
    orderBy("createdAt", "desc")
  );
  const snapshot = await getDocs(q);
  snapshot.forEach(doc => {
    const data = doc.data();
    // ê¸°ì¡´ì²˜ëŸ¼ ì œëª©Â·ìš”ì•½Â·ë‚ ì§œ ë Œë”ë§
  });
}


        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            loadInitialPageData(); 
        });
    </script>
    <script src="./js/gnb.js" defer></script>
</body>
</html>