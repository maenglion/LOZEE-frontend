<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>📖 Journal Test Page</title>
  <script type="module">
    import { db } from './js/firebase-config.js';
    import {
      collection, query, where, orderBy, limit, getDocs
    } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';

    const targetEmail = "maengnanyoung@gmail.com";

    async function loadJournalByEmail(email) {
      // 1. 이메일 → UID 조회
      const usersRef = collection(db, "users");
      const emailQuery = query(usersRef, where("email", "==", email));
      const userSnap = await getDocs(emailQuery);
      if (userSnap.empty) {
        document.body.innerHTML = "⚠️ 해당 이메일로 등록된 사용자가 없습니다.";
        return;
      }
      const userDoc = userSnap.docs[0];
      const userId = userDoc.id;

      // 2. 해당 UID의 최신 Journal 가져오기
      const journalsRef = collection(db, "journals");
      const journalQuery = query(
        journalsRef,
        where("userId", "==", userId),
        orderBy("createdAt", "desc"),
        limit(1)
      );
      const journalSnap = await getDocs(journalQuery);
      if (journalSnap.empty) {
        document.body.innerHTML = "⚠️ 해당 사용자에게 저장된 저널이 없습니다.";
        return;
      }

      const journal = journalSnap.docs[0].data();

      // 3. 화면에 표시
      const summary = journal.summary || "요약 없음";
      const title = journal.title || "제목 없음";
      const keywords = (journal.detailedAnalysis?.keywords || []).join(", ");
      const date = journal.createdAt?.toDate().toLocaleString('ko-KR') || "날짜 없음";

      document.body.innerHTML = `
        <h1>📝 ${title}</h1>
        <p><strong>날짜:</strong> ${date}</p>
        <h2>요약</h2>
        <pre>${summary}</pre>
        <h3>키워드</h3>
        <p>${keywords}</p>
      `;
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadJournalByEmail(targetEmail);
    });
  </script>
</head>
<body>
  <p>⏳ 불러오는 중...</p>
</body>
</html>
