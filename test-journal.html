<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“– Journal Test Page</title>
  <script type="module">
    import { db } from './js/firebase-config.js';
    import {
      collection, query, where, orderBy, limit, getDocs
    } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';

    const targetEmail = "maengnanyoung@gmail.com";

    async function loadJournalByEmail(email) {
      // 1. ì´ë©”ì¼ â†’ UID ì¡°íšŒ
      const usersRef = collection(db, "users");
      const emailQuery = query(usersRef, where("email", "==", email));
      const userSnap = await getDocs(emailQuery);
      if (userSnap.empty) {
        document.body.innerHTML = "âš ï¸ í•´ë‹¹ ì´ë©”ì¼ë¡œ ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }
      const userDoc = userSnap.docs[0];
      const userId = userDoc.id;

      // 2. í•´ë‹¹ UIDì˜ ìµœì‹  Journal ê°€ì ¸ì˜¤ê¸°
      const journalsRef = collection(db, "journals");
      const journalQuery = query(
        journalsRef,
        where("userId", "==", userId),
        orderBy("createdAt", "desc"),
        limit(1)
      );
      const journalSnap = await getDocs(journalQuery);
      if (journalSnap.empty) {
        document.body.innerHTML = "âš ï¸ í•´ë‹¹ ì‚¬ìš©ìì—ê²Œ ì €ì¥ëœ ì €ë„ì´ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }

      const journal = journalSnap.docs[0].data();

      // 3. í™”ë©´ì— í‘œì‹œ
      const summary = journal.summary || "ìš”ì•½ ì—†ìŒ";
      const title = journal.title || "ì œëª© ì—†ìŒ";
      const keywords = (journal.detailedAnalysis?.keywords || []).join(", ");
      const date = journal.createdAt?.toDate().toLocaleString('ko-KR') || "ë‚ ì§œ ì—†ìŒ";

      document.body.innerHTML = `
        <h1>ğŸ“ ${title}</h1>
        <p><strong>ë‚ ì§œ:</strong> ${date}</p>
        <h2>ìš”ì•½</h2>
        <pre>${summary}</pre>
        <h3>í‚¤ì›Œë“œ</h3>
        <p>${keywords}</p>
      `;
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadJournalByEmail(targetEmail);
    });
  </script>
</head>
<body>
  <p>â³ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
</body>
</html>
