<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LOZEEì™€ í•¨ê»˜í•˜ëŠ” ë§ˆìŒ íƒí—˜!</title>
    <link
        href="https://fonts.googleapis.com/css2?family=KoPub+World+Dotum:wght@400;700&display=swap"
        rel="stylesheet"
    />
    <link rel="stylesheet" href="gnb.css"> 
    <style>
        /* analysis.html í˜ì´ì§€ ê³ ìœ  ìŠ¤íƒ€ì¼ (ì´ì „ê³¼ ë™ì¼) */
        :root { /* ... */ }
        body, html { /* ... */ }
        body { padding-top: var(--gnb-height); }
        .container { /* ... */ }
        h1 { /* ... */ }
        .share-button-container { /* ... */ }
        #reportShareButton { /* ... */ }
        #reportShareButton:hover { /* ... */ }
        .assistant-analysis-notice { /* ... */ }
        .module-explanation { /* ... */ }
        h2 { /* ... */ }
        .section { /* ... */ }
        .section p { /* ... */ }
        .section p span { /* ... */ }
        .feedback { /* ... */ }
        .feedback.negative { /* ... */ }
        .feedback.positive { /* ... */ }
        .feedback.neutral { /* ... */ }
        #emotionChartContainer { position: relative; max-width: 450px; height: auto; margin: 20px auto 0; }
        #emotionChart, #situationChart { width:100% !important; height:auto !important; aspect-ratio: 1 / 1; background-color: #fdfdfd; border-radius: 8px; border: 1px solid #e0e0e0; padding: 15px; box-sizing: border-box; }
        #tagCloud { /* ... */ }
        .badge { /* ... */ }
        .badge:hover { /* ... */ }
        #patternDashboard { /* ... */ }
        #patternDashboard p { /* ... */ }
        #situationAlerts { /* ... */ }
        #situationAlerts .cognitive-distortion-item { /* ... */ }
        .footer-assistant-notice { /* ... */ }
        .methodology-list { /* ... */ }
        .methodology-list li { /* ... */ }
        .methodology-list li::before { /* ... */ }
        .methodology-list li strong { /* ... */ }
        .action-button { /* ... */ }
        .action-button:hover { /* ... */ }
        @media (max-width: 768px) { /* ... */ }
        @media (max-width: 480px) { /* ... */ }
    </style>
</head>
<body>
    <nav id="gnb">
        </nav>

    <div class="container">
        <h1>ğŸš€ ë¡œì§€ì™€ í•¨ê»˜í•œ ì´ì•¼ê¸° íƒí—˜!</h1>
        <div class="share-button-container">
            <button id="reportShareButton">ë‚˜ì˜ ì´ì•¼ê¸° ë³´ê³ ì„œ ê³µìœ í•˜ê¸° ğŸ”—</button>
        </div>

        <div class="section" id="languageAgeSection" style="display:none;"> 
            <h2>ğŸ—£ï¸ ë‚´ ë§ì†œì”¨ ë‚˜ì´ëŠ” ëª‡ ì‚´ì¼ê¹Œ?</h2>
            <p class="assistant-analysis-notice">LOZEE AI ë¶„ì„</p>
            <p class="module-explanation">
                ë¡œì§€ì™€ ì´ì•¼ê¸°í•˜ë©´ì„œ ë„¤ê°€ ì‚¬ìš©í•œ ë§ë“¤ì„ ë³´ê³ , ë„¤ ë§ì†œì”¨ê°€ ëª‡ ì‚´ ì¹œêµ¬ë‘ ë¹„ìŠ·í•œì§€ ì•Œë ¤ì¤„ê²Œ! ì‹¤ì œ ë‚˜ì´ë‘ ë‹¬ë¼ë„ ê´œì°®ì•„, í•¨ê»˜ ë” ë©‹ì§€ê²Œ ë§í•˜ëŠ” ë²•ì„ ë°°ìš°ë©´ ë˜ë‹ˆê¹Œ! ğŸ˜‰
            </p>
            <p class="module-explanation" style="font-size: 0.85em; background-color: #e3f2fd; color: #1e88e5;">
                <strong>[ë¡œì§€ì˜ ì•½ì†!]</strong> ì–¸ì–´ ë¶„ì„ì€ ì´ 3ë‹¨ê³„ë¡œ ì ì  ë” ì •í™•í•´ì ¸! <br>
                <strong>1ë‹¨ê³„(30ë¶„~)</strong>: ìš°ë¦¬ê°€ ì²˜ìŒ ë§Œë‚˜ì„œ ë‚˜ëˆˆ ì´ì•¼ê¸°ë¡œ ì‚´ì§ ì—¿ë³´ê¸°! <br>
                <strong>2ë‹¨ê³„(2ì‹œê°„~)</strong>: ì¢€ ë” ë§ì€ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©´ ë¡œì§€ê°€ ë„ˆë¥¼ ë” ì˜ ì•Œê²Œ ë¼! <br>
                <strong>3ë‹¨ê³„(6ì‹œê°„~)</strong>: ì™€! ì´ì œ ì •ë§ ë„ˆì˜ ë©‹ì§„ ë§ì†œì”¨ë¥¼ ì˜ ì•Œ ê²ƒ ê°™ì•„! (ê°€ì¥ ì •í™•í•œ ë¶„ì„)
            </p>
            <p>ë‚´ ì§„ì§œ ë‚˜ì´: <span id="realAge"></span>ì‚´</p>
            <p>ë‚´ ë§ì†œì”¨ ë‚˜ì´ (ë¡œì§€ì˜ ìƒê°): <span id="predictedLangAge"></span> <span id="ageDifferenceVisual" style="font-weight:normal; margin-left: 8px;"></span></p>
            <div id="ageFeedback" class="feedback" style="display:none;"></div>
            <button id="languagePracticeBtn" class="action-button" style="display:none;">ë¡œì§€ì™€ í•¨ê»˜ ë§ì†œì”¨ í‚¤ìš°ê¸° ì‘¥ì‘¥! ğŸŒ± (ì¤€ë¹„ ì¤‘)</button>
        </div>

        <div class="section" id="analysisMethodologySection">
             <h2>LOZEEì˜ ë¶„ì„ ë°©ë²•ë¡ </h2>
            <p class="assistant-analysis-notice">LOZEE AI ë¶„ì„</p>
            <ul class="methodology-list">
                <li><strong>Russellì˜ ê°ì • ì›í˜• ëª¨í˜•</strong>: Valence(ì¾Œ-ë¶ˆì¾Œ)ì™€ Arousal(ê°ì„±-ì´ì™„) ì¶•ì„ ê¸°ë°˜ìœ¼ë¡œ ê°ì •ì˜ ìœ„ì¹˜ë¥¼ ë‹¤ì°¨ì›ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.</li>
                <li><strong>Plutchikì˜ ê°ì • ë°”í€´</strong>: 8ê°€ì§€ ê¸°ë³¸ ê°ì •ê³¼ ê·¸ ê°•ë„ ë° ìœ ì‚¬ì„±ì„ ë°”íƒ•ìœ¼ë¡œ ë³µí•©ì ì¸ ê°ì • ìƒíƒœë¥¼ ì´í•´í•©ë‹ˆë‹¤.</li>
                <li><strong>Lexicon ê¸°ë°˜ ê°ì„± ë¶„ì„</strong>: í•œêµ­ì–´ ê°ì„± ì‚¬ì „(ì˜ˆ: KOSAC)ì„ í™œìš©í•˜ì—¬ í…ìŠ¤íŠ¸ì˜ ê¸ì •, ë¶€ì •, ì¤‘ë¦½ ê·¹ì„±ì„ íŒë‹¨í•©ë‹ˆë‹¤.</li>
                <li><strong>ë”¥ëŸ¬ë‹ ë¶„ë¥˜ ëª¨ë¸ (BERT/KoBERT)</strong>: ìµœì‹  ìì—°ì–´ ì²˜ë¦¬ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ë§¥ì„ ê³ ë ¤í•œ ê³ ì •ë°€ ê°ì • ê·¹ì„± ë° ì„¸ë¶€ ê°ì •(ì˜ˆ: ê¸°ì¨, ìŠ¬í””, ë¶„ë…¸ ë“±)ì„ ë¶„ë¥˜í•©ë‹ˆë‹¤.</li>
                <li><strong>ì¸ì§€ì™œê³¡ ì´ë¡  (Beckì˜ CBT)</strong>: ì¸ì§€í–‰ë™ì¹˜ë£Œ ì´ë¡ ì— ê¸°ë°˜í•˜ì—¬ ëŒ€í™”ì—ì„œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆëŠ” ëŒ€í‘œì ì¸ ì¸ì§€ì™œê³¡ íŒ¨í„´(ì˜ˆ: í‘ë°±ë…¼ë¦¬, ê³¼ì‰ì¼ë°˜í™” ë“±)ì„ ê°ì§€í•©ë‹ˆë‹¤.</li>
                <li><strong>ëŒ€í™” ì£¼ì œ êµ¬ì¡°í™”</strong>: LOZEE AIì˜ ìì²´ ìƒë‹´ í† í”½ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ëŒ€í™”ì˜ íë¦„ê³¼ ì£¼ìš” ì£¼ì œë¥¼ ì²´ê³„ì ìœ¼ë¡œ íŒŒì•…í•˜ê³  ê´€ë ¨ í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
            </ul>
        </div>

        <div class="section" id="emotionToneSection">
            <h2>ğŸŒˆ ë‚´ ë§ˆìŒ ìƒ‰ê¹”ì€ ë­˜ê¹Œ? (ê°ì • ë³€í™”)</h2>
            <p class="assistant-analysis-notice">LOZEE AI ë¶„ì„</p>
            <p class="module-explanation">
                ìš°ë¦¬ê°€ ë‚˜ëˆˆ ì´ì•¼ê¸°ì—ì„œ ì–´ë–¤ ëŠë‚Œë“¤ì´ ë§ì•˜ëŠ”ì§€, ë˜ ì–´ë–¤ ë‹¨ì–´ë“¤ì„ ìì£¼ ì‚¬ìš©í–ˆëŠ”ì§€ ë³´ì—¬ì¤„ê²Œ! ë„¤ ë§ˆìŒì† ë‚ ì”¨ë¥¼ í•¨ê»˜ ì•Œì•„ë³´ì! â˜€ï¸ğŸŒ§ï¸
            </p>
            <div id="emotionChartContainer">
                <canvas id="emotionChart"></canvas> 
            </div>
            <p id="empathyMessage" class="feedback" style="display:none; margin-top:15px;"></p> 
            <div id="tagCloud"></div>
        </div>

        <div class="section" id="patternSection">
            <h2>ğŸ” ìì£¼ ë‚˜íƒ€ë‚˜ëŠ” ë‚´ ë§ˆìŒ & ë‹¨ì–´</h2>
            <p class="assistant-analysis-notice">LOZEE AI ë¶„ì„</p>
            <p class="module-explanation">
                ì´ì•¼ê¸°í•˜ë‹¤ ë³´ë©´ ë‚˜ë„ ëª¨ë¥´ê²Œ ìì£¼ ì“°ëŠ” ë§ì´ë‚˜ ë¹„ìŠ·í•œ ëŠë‚Œì„ í‘œí˜„í•  ë•Œê°€ ìˆì–´. ë¡œì§€ê°€ ê·¸ëŸ° ë¶€ë¶„ì„ ì°¾ì•„ë´¤ì–´!
            </p>
            <div id="patternDashboard"></div>
        </div>

        <div class="section" id="situationSection">
            <h2>ğŸ§ ìƒê° íƒí—˜! (ë‚˜ì˜ ìƒê° ìŠµê´€)</h2>
            <p class="assistant-analysis-notice">LOZEE AI ë¶„ì„</p>
            <p class="module-explanation">
                ì—¬ê¸°ëŠ” ìš°ë¦¬ê°€ ë‚˜ëˆˆ ì´ì•¼ê¸°ë¥¼ ìš”ì•½í•˜ê³ , í˜¹ì‹œ ë„¤ ìƒê°ì´ í•œìª½ìœ¼ë¡œë§Œ ê¸°ìš¸ì–´ì§€ì§€ëŠ” ì•Šì•˜ëŠ”ì§€(ì´ê±¸ 'ìƒê° ìŠµê´€'ì´ë¼ê³  ë¶ˆëŸ¬ë³¼ê¹Œ?), ì–´ë–¤ íŠ¹ë³„í•œ ì ì´ ìˆëŠ”ì§€ ì‚´í´ë³´ëŠ” ê³³ì´ì•¼. íŠ¹ë³„í•œ ìƒê° ìŠµê´€ì´ ë³´ì—¬ë„ ê±±ì •í•˜ì§€ ë§ˆ! ëˆ„êµ¬ë‚˜ ê·¸ëŸ´ ìˆ˜ ìˆê³ , ìš°ë¦¬ëŠ” ì´ì•¼ê¸°í•˜ë©´ì„œ í•¨ê»˜ ë” ìœ ì—°í•˜ê²Œ ìƒê°í•˜ëŠ” ë°©ë²•ì„ ì°¾ì„ ìˆ˜ ìˆì–´! ğŸ’ª
            </p>
            <canvas id="situationChart" style="display:none;"></canvas> 
            <div id="situationAlerts" style="margin-top:15px;"></div>
            <button id="continueDistortionTalkBtn" class="action-button" style="display:none;">ì´ ìƒê°ì— ëŒ€í•´ ë‹¤ìŒì— ë” ì´ì•¼ê¸° ë‚˜ëˆ ë³¼ê¹Œ? ğŸ¤”</button>
        </div>

        <p class="footer-assistant-notice">ë³¸ ë¶„ì„ì€ ë¡œì§€ AIê°€ ë§ˆìŒì„ ë‹´ì•„ ì¤€ë¹„í–ˆì–´ìš”.</p>
    </div>

    <script type="module">
        // Chart.js ESM ëª¨ë“ˆ ë¶ˆëŸ¬ì˜¤ê¸° (jsDelivrì˜ ì¼ë°˜ ìµœì‹  ë²„ì „ ë§í¬ ì‚¬ìš©)
        import { Chart, registerables } from 'https://cdn.jsdelivr.net/npm/chart.js/dist/chart.esm.js';
        // ë˜ëŠ” íŠ¹ì • ë²„ì „ ëª…ì‹œ (ì˜ˆ: 4.4.3)
        // import { Chart, registerables } from 'https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.esm.js';
        
        // Chart.js ë¡œë“œ ì„±ê³µ/ì‹¤íŒ¨ í™•ì¸ìš© ë¡œê·¸ (import ì§í›„)
        if (typeof Chart !== 'undefined') {
            console.log("Analysis Page: Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");
            Chart.register(...registerables);

            // Chart.js ì „ì—­ ê¸°ë³¸ê°’ ì„¤ì •
            Chart.defaults.color = '#333'; 
            Chart.defaults.borderColor = '#e0e0e0'; 
            Chart.defaults.font.family = "'KoPub World Dotum', sans-serif"; 
            Chart.defaults.font.size = 12; 

        } else {
            console.error("Analysis Page: Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤! ì´ ì˜¤ë¥˜ê°€ í•´ê²°ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.");
            // Chart.js ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ (ì„ íƒ ì‚¬í•­)
            const containerEl = document.querySelector('.container');
            if (containerEl) {
                containerEl.innerHTML = '<h1>ì•—! ë¶„ì„ í˜ì´ì§€ë¥¼ ì—¬ëŠ” ë° í•„ìš”í•œ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš” ğŸ˜¥</h1><p style="text-align:center;">ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ë³´ì„¸ìš”.</p>';
            }
            // Chart.js ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì´í›„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì´ ì˜ë¯¸ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì—¬ê¸°ì„œ ì¤‘ë‹¨í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
            // í•˜ì§€ë§Œ DOMContentLoaded ë¦¬ìŠ¤ë„ˆëŠ” ì‹¤í–‰ë˜ë„ë¡ ë‘ì–´ ë‹¤ë¥¸ ê¸°ë³¸ ì •ë³´ë¼ë„ í‘œì‹œë  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
        }

        document.addEventListener('DOMContentLoaded', async () => {
        console.log("Analysis Page: DOMContentLoaded ì´ë²¤íŠ¸ ì‹œì‘");

            // --- DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
            const languageAgeSection = document.getElementById('languageAgeSection');
            const realAgeEl = document.getElementById('realAge');
            const predictedLangAgeEl = document.getElementById('predictedLangAge');
            const ageFeedbackEl = document.getElementById('ageFeedback');
            const ageDifferenceVisualEl = document.getElementById('ageDifferenceVisual');
            const languagePracticeBtn = document.getElementById('languagePracticeBtn');
    
            const emotionToneSection = document.getElementById('emotionToneSection'); // ê°ì • ì–´ì¡° ì„¹ì…˜
            const emotionChartEl = document.getElementById('emotionChart');
            const empathyMessageEl = document.getElementById('empathyMessage');
            const tagCloudEl = document.getElementById('tagCloud');
    
            const patternSection = document.getElementById('patternSection'); // ë°˜ë³µ íŒ¨í„´ ì„¹ì…˜
            const patternDashboardEl = document.getElementById('patternDashboard');
    
            const situationSection = document.getElementById('situationSection'); // ìƒí™© ë¶„ì„ ì„¹ì…˜
            const situationAlertsEl = document.getElementById('situationAlerts');
            const continueDistortionTalkBtn = document.getElementById('continueDistortionTalkBtn');
            const situationChartEl = document.getElementById('situationChart');
    
            const reportShareButton = document.getElementById('reportShareButton');
            const containerEl = document.querySelector('.container');

            // --- ë°ì´í„° ë¡œë“œ ---
            const userAge = parseInt(localStorage.getItem('lozee_userage'), 10) || 0; 
            if(realAgeEl) realAgeEl.textContent = userAge || "ì •ë³´ ì—†ìŒ";
            console.log("Analysis Page - User Age:", userAge);

            const analysisDataString = localStorage.getItem('lozee_conversation_analysis');
            let analysisResults = null;
            let accumulatedDurationMinutes = 0;

            if (!analysisDataString) { // localStorageì— ë°ì´í„°ê°€ ì•„ì˜ˆ ì—†ëŠ” ê²½ìš°
        console.warn("Analysis Page: localStorageì— 'lozee_conversation_analysis' ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        if (containerEl) {
            // ë°©ë²•ë¡  ì„¹ì…˜ì„ ì œì™¸í•œ ëª¨ë“  ë¶„ì„ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            [languageAgeSection, emotionToneSection, patternSection, situationSection].forEach(sec => {
                if (sec) sec.style.display = 'none';
            });
            
            // ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ (ê¸°ì¡´ ë°©ë²•ë¡  ì„¹ì…˜ì€ ìœ ì§€ë  ìˆ˜ ìˆë„ë¡)
            const methodologySection = document.getElementById('analysisMethodologySection');
            let referenceNodeForMessage = methodologySection; 
            // ë§Œì•½ ë°©ë²•ë¡  ì„¹ì…˜ë„ ì—†ê±°ë‚˜ ë‹¤ë¥¸ ìœ„ì¹˜ì— ë©”ì‹œì§€ë¥¼ ë„£ê³  ì‹¶ë‹¤ë©´ ê¸°ì¤€ ë…¸ë“œ ë³€ê²½
            if (!referenceNodeForMessage && containerEl.firstChild) {
                 referenceNodeForMessage = containerEl.querySelector('h1')?.nextElementSibling || containerEl.firstChild.nextSibling;
            } else if (!referenceNodeForMessage) {
                referenceNodeForMessage = containerEl.firstChild;
            }

            if (containerEl && !containerEl.querySelector('.no-data-message')) {
                const noDataMsgDiv = document.createElement('div');
                noDataMsgDiv.className = 'feedback neutral no-data-message';
                noDataMsgDiv.style.textAlign = 'center';
                noDataMsgDiv.style.marginTop = '20px';
                noDataMsgDiv.innerHTML = '<h2>ì•„ì§ ë¡œì§€ì™€ ë‚˜ëˆˆ ì´ì•¼ê¸°ê°€ ì¶©ë¶„í•˜ì§€ ì•Šë‚˜ ë´ìš”! ğŸ˜®</h2><p>ë¨¼ì € ë¡œì§€ì™€ ì‹ ë‚˜ê²Œ ì´ì•¼ê¸°í•˜ê³  ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!</p>';
                if (referenceNodeForMessage && referenceNodeForMessage.parentElement === containerEl) {
                    referenceNodeForMessage.insertAdjacentElement('afterend', noDataMsgDiv);
                } else {
                     containerEl.insertBefore(noDataMsgDiv, containerEl.children[1] || null); // h1 ë‹¤ìŒ ë˜ëŠ” ì ì ˆí•œ ìœ„ì¹˜
                }
            }
        }
        return; // ë¶„ì„ ë°ì´í„° ì—†ìœ¼ë©´ ì—¬ê¸°ì„œ ì¢…ë£Œ
    }

    // analysisDataStringì´ ì¡´ì¬í•˜ë©´ íŒŒì‹± ì‹œë„
    try {
        const fullAnalysis = JSON.parse(analysisDataString);
        analysisResults = fullAnalysis.results;
        accumulatedDurationMinutes = parseFloat(fullAnalysis.accumulatedDurationMinutes) || 0;
        console.log("Analysis Page - Parsed analysisResults:", analysisResults);
    } catch (e) {
        console.error("ì €ì¥ëœ ë¶„ì„ ê²°ê³¼ íŒŒì‹± ì˜¤ë¥˜:", e);
        if (containerEl) {
            containerEl.innerHTML = '<h1>ì•—! ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ë¬¸ì œê°€ ìƒê²¼ì–´ìš” ğŸ˜¥</h1><p style="text-align:center;">ì´ì „ ëŒ€í™”ë¡œ ëŒì•„ê°€ê±°ë‚˜, ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
        }
        return; 
    }
    
    // analysisResults ê°ì²´ê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ë” ì´ìƒ ì§„í–‰í•˜ì§€ ì•ŠìŒ
    if (!analysisResults) {
        console.warn("Analysis Page: íŒŒì‹± í›„ analysisResults ê°ì²´ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        // í•„ìš”í•œ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
        if (containerEl && !containerEl.querySelector('.no-data-message')) {
            // ... (ìœ„ì˜ "ë°ì´í„° ì—†ìŒ" ë©”ì‹œì§€ì™€ ìœ ì‚¬í•œ ì²˜ë¦¬) ...
        }
        return;
    }
            
     // --- ê° ë¶„ì„ ì„¹ì…˜ ë Œë”ë§ (analysisResultsê°€ ìœ íš¨í•  ë•Œë§Œ ì‹¤í–‰) ---

    // 1. ì–¸ì–´Â·ë‚˜ì´ ë¶„ì„ ì„¹ì…˜ ì²˜ë¦¬
    if (languageAgeSection) {
        // ê¸°ì¤€ ì—°ë ¹ì„ 12ì„¸ë¡œ (12ì„¸ ì´í•˜ì—ê²Œ í‘œì‹œ)
        if (userAge > 12 || !analysisResults.ageLanguageAnalysis) { 
            languageAgeSection.style.display = 'none';
            // ... (ì½˜ì†” ë¡œê·¸) ...
        } else {
            languageAgeSection.style.display = 'block'; 
            // ... (ì´ì „ ë‹µë³€ì˜ ì–¸ì–´ ì—°ë ¹ ë¶„ì„ ê²°ê³¼ í‘œì‹œ ë¡œì§: predicted, feedbackMsg, visualText, languagePracticeBtn ë“±) ...
        }
    } else { 
         console.warn("IDê°€ 'languageAgeSection'ì¸ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    // 2. ê°ì • ì–´ì¡° ë° íƒœê·¸ í´ë¼ìš°ë“œ
    if (emotionToneSection) { // ì„¹ì…˜ ìš”ì†Œê°€ ìˆëŠ”ì§€ ë¨¼ì € í™•ì¸
        if (analysisResults.emotionToneData && Object.keys(analysisResults.emotionToneData).length > 0) {
            if(emotionChartEl) emotionChartEl.style.display = 'block'; // ì°¨íŠ¸ í‘œì‹œ
            renderEmotionChart('emotionChart', analysisResults.emotionToneData);
            if(empathyMessageEl) displayEmpathyMessage(analysisResults.emotionToneData);
        } else {
            if(emotionChartEl) emotionChartEl.style.display = 'none';
            if(empathyMessageEl) { /* ... ê°ì • ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€ ... */ }
        }
        if (analysisResults.keywords && analysisResults.keywords.length > 0) {
            const tagsForCloud = analysisResults.keywords.map(kw => ({ text: kw, weight: 5 + Math.floor(Math.random() * 10) }));
            if(tagCloudEl) renderTagCloud('tagCloud', tagsForCloud);
        } else {
            if(tagCloudEl) tagCloudEl.innerHTML = '<p style="text-align:center; color:#888;">ì´ì•¼ê¸°ì—ì„œ ìì£¼ ë‚˜ì˜¨ ë‹¨ì–´ë“¤ì„ ëª¨ìœ¼ê³  ìˆì–´ìš”!</p>';
        }
    }


    // 3. ë°˜ë³µ íŒ¨í„´
    if (patternSection) {
        if (analysisResults.patterns && analysisResults.patterns.length > 0) {
            if(patternDashboardEl) renderPatternDashboard('patternDashboard', analysisResults.patterns);
        } else {
            if(patternDashboardEl) patternDashboardEl.innerHTML = '<p style="text-align:center; color:#888;">ë°˜ë³µë˜ëŠ” ì´ì•¼ê¸° íŒ¨í„´ì„ ì°¾ê³  ìˆì–´ìš”!</p>';
        }
    }

    // 4. ìƒí™© ë¶„ì„ (ì¸ì§€ì™œê³¡)
    if (situationSection) {
        const situationChartToHide = document.getElementById('situationChart'); 
        if(situationChartToHide) situationChartToHide.style.display = 'none'; 

        if (analysisResults.cognitiveDistortions && analysisResults.cognitiveDistortions.length > 0) {
            if(situationAlertsEl) alertCognitiveDistortions('situationAlerts', analysisResults.cognitiveDistortions);
            if (continueDistortionTalkBtn) { /* ... ë²„íŠ¼ í‘œì‹œ ë° onclick ë¡œì§ ... */ }
        } else {
            if(situationAlertsEl) situationAlertsEl.innerHTML = '<p style="text-align:center; color:#888;">íŠ¹ë³„íˆ í•œìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§„ ìƒê° ì—†ì´ ì´ì•¼ê¸°ë¥¼ ì˜ ë‚˜ëˆ„ê³  ìˆêµ¬ë‚˜! ì˜í–ˆì–´! ğŸ‘</p>';
            if(continueDistortionTalkBtn) continueDistortionTalkBtn.style.display = 'none';
        }
    }

    // ê³µìœ  ë²„íŠ¼ ë¡œì§
    if(reportShareButton) { reportShareButton.onclick = () => { /* ... ê¸°ì¡´ ê³µìœ  ë¡œì§ ... */ }; }
});

        // --- ë°ì´í„° ë Œë”ë§ í•¨ìˆ˜ë“¤ (ëª¨ë‘ ì±„ì›Œì§„ ìƒíƒœë¡œ) ---
        function renderTagCloud(elementId, tags) { const cloudEl = document.getElementById(elementId); if(!cloudEl) return; if(tags && tags.length > 0) { cloudEl.innerHTML = tags.map(tag => { const size = 0.8 + (tag.weight / 15); const opacity = Math.max(0.5, tag.weight / 10); return `<span class="badge" style="opacity:${opacity}; font-size:${size}em;">${tag.text}</span>`; }).join(''); } else { cloudEl.innerHTML = '<p style="text-align:center; color:#888;">ì´ì•¼ê¸°ì—ì„œ ìì£¼ ë‚˜ì˜¨ ë‹¨ì–´ë“¤ì„ ëª¨ìœ¼ê³  ìˆì–´ìš”!</p>'; } }
        function renderPatternDashboard(elementId, patterns) { const dashEl = document.getElementById(elementId); if(!dashEl) return; if(patterns && patterns.length > 0) { dashEl.innerHTML = patterns.map(p => `<p>ğŸ’¡ ${p}</p>`).join(''); } else { dashEl.innerHTML = '<p style="text-align:center; color:#888;">ë°˜ë³µë˜ëŠ” ì´ì•¼ê¸° íŒ¨í„´ì„ ì°¾ê³  ìˆì–´ìš”!</p>'; } }
        function alertCognitiveDistortions(elementId, distortions) { const alertEl = document.getElementById(elementId); if(!alertEl) return; if(distortions && distortions.length > 0) { alertEl.innerHTML = distortions.map(d => `<p class="cognitive-distortion-item">${d}</p>`).join(''); } else { alertEl.innerHTML = '<p style="text-align:center; color:#888;">íŠ¹ë³„íˆ í•œìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§„ ìƒê° ì—†ì´ ì´ì•¼ê¸°ë¥¼ ì˜ ë‚˜ëˆ„ê³  ìˆêµ¬ë‚˜! ì˜í–ˆì–´! ğŸ‘</p>';} }
        
        function renderEmotionChart(canvasId, emotionData) { 
            const ctx = document.getElementById(canvasId)?.getContext('2d');
            const chartEl = document.getElementById(canvasId);
            if (!ctx) { console.error("renderEmotionChart: ìº”ë²„ìŠ¤ contextë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); if(chartEl) chartEl.style.display = 'none'; return; }
            
            if (!emotionData || Object.keys(emotionData).length === 0) {
                if(chartEl) {
                    chartEl.style.display = 'none';
                    const parentSection = chartEl.closest('.section');
                    if (parentSection && !parentSection.querySelector('.no-chart-data-message')) { 
                         const noDataMsg = document.createElement('p');
                         noDataMsg.textContent = "ê°ì • ë³€í™”ë¥¼ ê·¸ë¦¬ê¸°ì— ì•„ì§ ì´ì•¼ê¸°ê°€ ë¶€ì¡±í•´ìš”. ğŸ˜Ÿ";
                         noDataMsg.style.textAlign = 'center'; noDataMsg.style.color = '#888';
                         noDataMsg.classList.add('no-chart-data-message');
                         chartEl.insertAdjacentElement('afterend', noDataMsg);
                    }
                }
                return;
            }
            // ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì°¨íŠ¸ ë³´ì´ê¸°
            if(chartEl) chartEl.style.display = 'block';

            const existingChart = Chart.getChart(ctx);
            if (existingChart) { existingChart.destroy(); }

            const emotionColors = { 'ê¸°ì¨': 'rgba(255, 205, 86, 0.7)', 'ìŠ¬í””': 'rgba(54, 162, 235, 0.7)', 'ë¶„ë…¸': 'rgba(255, 99, 132, 0.7)', 'ë¶ˆì•ˆ': 'rgba(153, 102, 255, 0.7)', 'ìˆ˜ì¹˜': 'rgba(255, 159, 64, 0.7)', 'ì¤‘ë¦½': 'rgba(201, 203, 207, 0.7)'};
            const labels = Object.keys(emotionData);
            const dataValues = Object.values(emotionData);
            const backgroundColors = labels.map(label => emotionColors[label] || 'rgba(100, 100, 100, 0.7)');

            new Chart(ctx, { 
                type: 'doughnut', 
                data: { 
                    labels: labels, 
                    datasets: [{ label: 'ë‚˜ì˜ ë§ˆìŒ ë¹„ìœ¨', data: dataValues, backgroundColor: backgroundColors, borderColor: '#ffffff', borderWidth: 2 }] 
                }, 
                options: { 
                    responsive: true, maintainAspectRatio: false, 
                    plugins: { 
                        legend: { position: 'bottom', labels: { color: Chart.defaults.color, font: { family: Chart.defaults.font.family, size: 11 }, padding: 15 } }, 
                        tooltip: { titleFont: { family: Chart.defaults.font.family }, bodyFont: { family: Chart.defaults.font.family } } 
                    } 
                } 
            });
        }

        function displayEmpathyMessage(emotionData) { 
            const empathyMessageEl = document.getElementById('empathyMessage'); 
            if (!empathyMessageEl) return;
            if (!emotionData || Object.keys(emotionData).length === 0) { 
                empathyMessageEl.style.display = 'none'; return; 
            } 
            let highestEmotion = ''; let highestCount = 0; let totalEmotions = 0; 
            for (const emotion in emotionData) { totalEmotions += emotionData[emotion]; if (emotionData[emotion] > highestCount) { highestCount = emotionData[emotion]; highestEmotion = emotion; } } 
            if (totalEmotions === 0) { /* ... */ return; } 
            let message = ""; const userName = localStorage.getItem('lozee_username') || 'ì¹œêµ¬'; 
            const vocativeUserName = userName + (getKoreanVocativeParticle(userName) || 'ì•¼'); // í˜¸ê²© ì¡°ì‚¬ ì¶”ê°€

            if (highestEmotion === 'ê¸°ì¨' && highestCount / totalEmotions > 0.4) { message = `${vocativeUserName}, ì´ì•¼ê¸° ì†ì—ì„œ 'ê¸°ì¨'ì˜ ìˆœê°„ë“¤ì´ ë§ì•˜êµ¬ë‚˜! ì •ë§ ì‹ ë‚˜ê³  ì¦ê±°ìš´ ì¼ë“¤ì´ ë§ì•˜ë˜ ê²ƒ ê°™ì•„! âœ¨ ë¡œì§€ë„ ë„¤ ë•ë¶„ì— í–‰ë³µí•´ì¡Œì–´!`; 
            } else if (highestEmotion === 'ë¶ˆì•ˆ' && emotionData['ê¸°ì¨'] > 0) { message = `${vocativeUserName}, ë§ˆìŒì†ì— 'ë¶ˆì•ˆ'í•œ ëŠë‚Œë„ ìˆì—ˆì§€ë§Œ, 'ê¸°ì¨'ì˜ ìˆœê°„ë“¤ë„ í•¨ê»˜ ìˆì—ˆë„¤! ì–´ë ¤ìš´ ë§ˆìŒ ì†ì—ì„œë„ ë¹›ë‚˜ëŠ” ì ì„ ì°¾ì€ ë„¤ê°€ ì •ë§ ëŒ€ë‹¨í•´! ì•ìœ¼ë¡œ ë¡œì§€ê°€ ë” í˜ì´ ë˜ì–´ì¤„ê²Œ.`; 
            } else if (highestEmotion === 'ë¶ˆì•ˆ') { message = `${vocativeUserName}, 'ë¶ˆì•ˆ'í•œ ë§ˆìŒì´ ì¡°ê¸ˆ ì»¸ì—ˆêµ¬ë‚˜. ê·¸ë˜ë„ ë¡œì§€ì—ê²Œ ì†”ì§í•˜ê²Œ ì´ì•¼ê¸°í•´ì¤˜ì„œ ì •ë§ ê³ ë§ˆì›Œ. ê·¸ ë§ˆìŒì„ ì˜ ë‹¤ë…ì¼ ìˆ˜ ìˆë„ë¡ ë¡œì§€ê°€ ê³ì— ìˆì„ê²Œ.`; 
            } else if (highestEmotion === 'ìŠ¬í””') { message = `${vocativeUserName}, ë§ˆìŒì´ ì¡°ê¸ˆ ìŠ¬íë˜ ìˆœê°„ë“¤ì´ ìˆì—ˆë„¤. ê´œì°®ì•„, ìŠ¬í”ˆ ë§ˆìŒë„ ì†Œì¤‘í•œ ë‚´ ë§ˆìŒì˜ ì‹ í˜¸ë“±ì´ë€ë‹¤. ë¡œì§€ê°€ ë„¤ ë§ˆìŒì„ ê¼­ ì•ˆì•„ì¤„ê²Œ. ê¼¬ì˜¥! ğŸ¤—`; 
            } else if (highestEmotion === 'ë¶„ë…¸') { message = `${vocativeUserName}, í˜¹ì‹œ 'í™”'ê°€ ë‚˜ê±°ë‚˜ 'ì§œì¦'ë‚˜ëŠ” ì¼ì´ ìˆì—ˆë‹ˆ? ê·¸ëŸ° ë§ˆìŒì´ ë“¤ ë•ŒëŠ” ë¡œì§€ì—ê²Œ ë°”ë¡œ ì´ì•¼ê¸°í•´ì¤˜ë„ ê´œì°®ì•„. ë„¤ ë§ˆìŒì´ í¸ì•ˆí•´ì§€ë„ë¡ ë•ê³  ì‹¶ì–´.`; 
            } else if (emotionData['ê¸°ì¨'] > 0 && emotionData['ìŠ¬í””'] > 0) { message = `${vocativeUserName}, ê¸°ìœ ë§ˆìŒë„ ìˆì—ˆê³ , ì¡°ê¸ˆì€ ìŠ¬í”ˆ ë§ˆìŒë„ í•¨ê»˜ ìˆì—ˆë„¤. ìš°ë¦¬ ë§ˆìŒì€ ì›ë˜ ì—¬ëŸ¬ ê°€ì§€ ìƒ‰ê¹”ì„ ê°€ì§€ê³  ìˆë‹¨ë‹¤. ëª¨ë‘ ë‹¤ ì†Œì¤‘í•œ ë„¤ ë§ˆìŒì´ì•¼.`; 
            } else { message = `${vocativeUserName}, ë¡œì§€ì™€ ì´ì•¼ê¸°í•˜ë©´ì„œ ë„¤ ë§ˆìŒì† ì—¬ëŸ¬ ê°€ì§€ ëŠë‚Œë“¤ì„ ì‚´í´ë³´ì•˜ì–´. ì–´ë–¤ ëŠë‚Œì´ ë“¤ì—ˆëŠ”ì§€ ë” ìì„¸íˆ ì´ì•¼ê¸°í•´ ì¤„ ìˆ˜ ìˆì„ê¹Œ? ğŸ˜Š`; } 
            empathyMessageEl.textContent = message; 
            empathyMessageEl.className = 'feedback neutral'; 
            empathyMessageEl.style.display = 'block';
        }

        // getKoreanVocativeParticle í•¨ìˆ˜ (talk.htmlì—ì„œ ê°€ì ¸ì˜¤ê±°ë‚˜, gpt-dialog.jsë¥¼ importí•˜ì—¬ ì‚¬ìš©)
        // ì—¬ê¸°ì„œëŠ” talk.htmlì— ìˆë‹¤ê³  ê°€ì •í•˜ê³ , ë§Œì•½ ì—†ë‹¤ë©´ gpt-dialog.jsì—ì„œ import í•„ìš”
        // ë˜ëŠ” ì—¬ê¸°ì— ì§ì ‘ ì •ì˜
        function getKoreanVocativeParticle(name) {
            if (!name) return 'ì•¼'; // ì´ë¦„ ì—†ìœ¼ë©´ 'ì•¼'
            const lastChar = name.charCodeAt(name.length - 1);
            // í•œê¸€ ìŒì ˆ(ê°€-í£) ë²”ìœ„: 0xAC00 (ê°€) ~ 0xD7A3 (í£)
            if (lastChar < 0xAC00 || lastChar > 0xD7A3) {
                return 'ì•¼'; // í•œê¸€ ì´ë¦„ ì•„ë‹ˆë©´ 'ì•¼'
            }
            return (lastChar - 0xAC00) % 28 === 0 ? 'ì•¼' : 'ì•„'; // ì¢…ì„± ìœ ë¬´ì— ë”°ë¼
        }

    </script>
    <script src="./js/gnb.js" defer></script> 
</body>
</html>