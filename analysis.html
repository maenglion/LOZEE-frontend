<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LOZEEì™€ í•¨ê»˜í•˜ëŠ” ë§ˆìŒ íƒí—˜!</title>
    <link
        href="https://fonts.googleapis.com/css2?family=KoPub+World+Dotum:wght@400;700&display=swap"
        rel="stylesheet"
    />
    <link rel="stylesheet" href="gnb.css"> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        /* analysis.html í˜ì´ì§€ ê³ ìœ  ìŠ¤íƒ€ì¼ (ì´ì „ê³¼ ë™ì¼) */
        :root {
            --primary-color-analysis: #6078ea;
            --card-bg-analysis: #ffffff;
            --text-color-analysis: #333333;
            --explanation-bg-analysis: #eef2f7;
            --gnb-height: 56px; 
        }
        body, html { 
            margin:0; 
            padding:0; 
            font-family:'KoPub World Dotum', sans-serif; 
            background:#f4f6f8; 
            color: var(--text-color-analysis); 
        }
        body { padding-top: var(--gnb-height); }
        .container { max-width:900px; margin:25px auto; padding:0 25px; box-sizing: border-box; }
        h1 { color: var(--primary-color-analysis); text-align: center; font-size: 2em; margin-bottom: 15px; font-weight: 700; }
        .share-button-container { text-align: center; margin-bottom: 30px; }
        #reportShareButton { background-color: #6e8efb; color: white; padding: 10px 20px; border: none; border-radius: 20px; font-size: 0.95em; cursor: pointer; transition: background-color 0.2s, box-shadow 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #reportShareButton:hover { background-color: #5a7edf; box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .assistant-analysis-notice { font-size: 0.75em; color: #78909c; margin-top: -12px; margin-bottom: 15px; text-align: right; }
        .module-explanation { font-size:0.9em; color:#555; margin-bottom:15px; padding: 10px; background-color: var(--explanation-bg-analysis); border-radius: 6px; line-height: 1.6; }
        h2 { margin-top:0; margin-bottom: 8px; font-size:1.5em; color:#34495e; border-bottom: 2px solid #e0e0e0; padding-bottom: 12px; }
        .section { background:var(--card-bg-analysis); padding:25px; margin-top:25px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
        .section p { color: #555555; line-height: 1.7; font-size: 1em; }
        .section p span { color: #2c3e50; font-weight: bold; }
        .feedback { margin-top:15px; padding:12px 18px; border-left-width:5px; border-left-style:solid; border-radius:8px; font-size: 0.95em; line-height: 1.6; }
        .feedback.negative { background:#ffebee; border-left-color: #c62828; color:#c62828; }
        .feedback.positive { background:#e8f5e9; border-left-color: #2e7d32; color:#2e7d32; }
        .feedback.neutral { background:#eceff1; border-left-color: #546e7a; color:#37474f; }
        #emotionChartContainer { position: relative; max-width: 450px; min-height: 100px; height: auto; margin: 20px auto 0; display: flex; align-items: center; justify-content: center;}
        #emotionChart, #situationChart { width:100% !important; height:auto !important; aspect-ratio: 1 / 1; background-color: #fdfdfd; border-radius: 8px; border: 1px solid #e0e0e0; padding: 15px; box-sizing: border-box; display: none; }
        #tagCloud { min-height:100px; border:1px dashed #cccccc; padding:15px; margin-top: 20px; border-radius: 8px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center; }
        .badge { display:inline-block; margin:4px; padding:8px 12px; background:#e8eaf6; color: #3f51b5; border-radius:16px; font-size:0.9em; transition: background-color 0.2s, color 0.2s; font-weight: 500; }
        .badge:hover { background-color: #c5cae9; color: #303f9f; }
        #patternDashboard { margin-top: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 8px; color: #444; min-height: 50px; }
        #patternDashboard p { color: #444; margin-bottom: 8px; }
        #situationAlerts { margin-top: 15px; min-height: 50px; }
        #situationAlerts .cognitive-distortion-item { background:#fff3cd; border-left: 5px solid #ffc107; color: #856404; padding: 10px 15px; margin-bottom: 10px; border-radius: 4px; font-size: 0.9em; }
        .footer-assistant-notice { text-align: center; margin-top: 40px; margin-bottom: 20px; font-size: 0.8em; color: #78909c; }
        .methodology-list { list-style-type: none; padding-left: 0; font-size: 0.9em; color: #555; }
        .methodology-list li { margin-bottom: 12px; padding-left: 25px; position: relative; }
        .methodology-list li::before { content: "ğŸ’¡"; color: #6078ea; position: absolute; left: 0; font-size: 1.1em; }
        .methodology-list li strong { color: #34495e; }
        .action-button { display: inline-block; margin-top: 15px; background-color: #6e8efb; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9em; transition: background-color 0.2s; }
        .action-button:hover { background-color: #5a7edf; }
        @media (max-width: 768px) { /* ... */ }
        @media (max-width: 480px) { /* ... */ }
    </style>
</head>
<body>
    <nav id="gnb">
        <div id="gnb-title">LOZEE</div>
        <button id="menu-toggle">â˜°</button>
        <div id="dropdown-menu">
          <a href="mypage.html">ğŸ¨ ë‚´ ì •ë³´ ë³´ê¸°</a> 
          <a href="index.html">âœ¨ ìƒˆë¡œìš´ ì´ì•¼ê¸° ì‹œì‘!</a> 
          <a href="analysis.html">ğŸ“Š ìš°ë¦¬ ì´ì•¼ê¸° ë¶„ì„</a> 
          <a href="journal-list.html">ğŸ“– ì´ì•¼ê¸° ëª¨ìŒì§‘</a> 
          <a href="https://www.notion.so/maenglionworld/lOZEE-1ebbcdc037cd80fa9c0ddef234121e84?pvs=4" target="_blank">â“ ë¡œì§€ ì‚¬ìš© ì„¤ëª…ì„œ</a> 
        </div>
    </nav>

    <div class="container">
        <h1>ğŸš€ ë¡œì§€ì™€ í•¨ê»˜í•œ ì´ì•¼ê¸° íƒí—˜!</h1>
        <div class="share-button-container">
            <button id="reportShareButton">ë‚˜ì˜ ì´ì•¼ê¸° ë³´ê³ ì„œ ê³µìœ í•˜ê¸° ğŸ”—</button>
        </div>

        <div class="section" id="languageAgeSection" style="display:none;"> 
            <h2>ğŸ—£ï¸ ë‚´ ë§ì†œì”¨ ë‚˜ì´ëŠ” ëª‡ ì‚´ì¼ê¹Œ?</h2>
            <p class="assistant-analysis-notice">LOZEE AI ë¶„ì„</p>
            <p class="module-explanation">
                ë¡œì§€ì™€ ì´ì•¼ê¸°í•˜ë©´ì„œ ë„¤ê°€ ì‚¬ìš©í•œ ë§ë“¤ì„ ë³´ê³ , ë„¤ ë§ì†œì”¨ê°€ ëª‡ ì‚´ ì¹œêµ¬ë‘ ë¹„ìŠ·í•œì§€ ì•Œë ¤ì¤„ê²Œ! ì‹¤ì œ ë‚˜ì´ë‘ ë‹¬ë¼ë„ ê´œì°®ì•„, í•¨ê»˜ ë” ë©‹ì§€ê²Œ ë§í•˜ëŠ” ë²•ì„ ë°°ìš°ë©´ ë˜ë‹ˆê¹Œ! ğŸ˜‰
            </p>
            <p class="module-explanation" style="font-size: 0.85em; background-color: #e3f2fd; color: #1e88e5;">
                <strong>[ë¡œì§€ì˜ ì•½ì†!]</strong> ì–¸ì–´ ë¶„ì„ì€ ì´ 3ë‹¨ê³„ë¡œ ì ì  ë” ì •í™•í•´ì ¸! <br>
                <strong>1ë‹¨ê³„(30ë¶„~)</strong>: ìš°ë¦¬ê°€ ì²˜ìŒ ë§Œë‚˜ì„œ ë‚˜ëˆˆ ì´ì•¼ê¸°ë¡œ ì‚´ì§ ì—¿ë³´ê¸°! <br>
                <strong>2ë‹¨ê³„(2ì‹œê°„~)</strong>: ì¢€ ë” ë§ì€ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©´ ë¡œì§€ê°€ ë„ˆë¥¼ ë” ì˜ ì•Œê²Œ ë¼! <br>
                <strong>3ë‹¨ê³„(6ì‹œê°„~)</strong>: ì™€! ì´ì œ ì •ë§ ë„ˆì˜ ë©‹ì§„ ë§ì†œì”¨ë¥¼ ì˜ ì•Œ ê²ƒ ê°™ì•„! (ê°€ì¥ ì •í™•í•œ ë¶„ì„)
            </p>
            <p>ë‚´ ì§„ì§œ ë‚˜ì´: <span id="realAge"></span>ì‚´</p>
            <p>ë‚´ ë§ì†œì”¨ ë‚˜ì´ (ë¡œì§€ì˜ ìƒê°): <span id="predictedLangAge"></span> <span id="ageDifferenceVisual" style="font-weight:normal; margin-left: 8px;"></span></p>
            <div id="ageFeedback" class="feedback" style="display:none;"></div>
            <button id="languagePracticeBtn" class="action-button" style="display:none;">ë¡œì§€ì™€ í•¨ê»˜ ë§ì†œì”¨ í‚¤ìš°ê¸° ì‘¥ì‘¥! ğŸŒ± (ì¤€ë¹„ ì¤‘)</button>
        </div>

        <div class="section" id="analysisMethodologySection">
            </div>

        <div class="section" id="emotionToneSection">
            <h2>ğŸŒˆ ë‚´ ë§ˆìŒ ìƒ‰ê¹”ì€ ë­˜ê¹Œ? (ê°ì • ë³€í™”)</h2>
            <p class="assistant-analysis-notice">LOZEE AI ë¶„ì„</p>
            <p class="module-explanation">
                ìš°ë¦¬ê°€ ë‚˜ëˆˆ ì´ì•¼ê¸°ì—ì„œ ì–´ë–¤ ëŠë‚Œë“¤ì´ ë§ì•˜ëŠ”ì§€, ë˜ ì–´ë–¤ ë‹¨ì–´ë“¤ì„ ìì£¼ ì‚¬ìš©í–ˆëŠ”ì§€ ë³´ì—¬ì¤„ê²Œ! ë„¤ ë§ˆìŒì† ë‚ ì”¨ë¥¼ í•¨ê»˜ ì•Œì•„ë³´ì! â˜€ï¸ğŸŒ§ï¸
            </p>
            <div id="emotionChartContainer"> 
                <canvas id="emotionChart"></canvas> 
            </div>
            <p id="empathyMessage" class="feedback" style="display:none; margin-top:15px;"></p> 
            <div id="tagCloud"></div>
        </div>

        <div class="section" id="patternSection">
            <h2>ğŸ” ìì£¼ ë‚˜íƒ€ë‚˜ëŠ” ë‚´ ë§ˆìŒ & ë‹¨ì–´</h2>
            <p class="assistant-analysis-notice">LOZEE AI ë¶„ì„</p>
            <p class="module-explanation">
                ì´ì•¼ê¸°í•˜ë‹¤ ë³´ë©´ ë‚˜ë„ ëª¨ë¥´ê²Œ ìì£¼ ì“°ëŠ” ë§ì´ë‚˜ ë¹„ìŠ·í•œ ëŠë‚Œì„ í‘œí˜„í•  ë•Œê°€ ìˆì–´. ë¡œì§€ê°€ ê·¸ëŸ° ë¶€ë¶„ì„ ì°¾ì•„ë´¤ì–´!
            </p>
            <div id="patternDashboard"></div>
        </div>

        <div class="section" id="situationSection">
            <h2>ğŸ§ ìƒê° íƒí—˜! (ë‚˜ì˜ ìƒê° ìŠµê´€)</h2>
            <p class="assistant-analysis-notice">LOZEE AI ë¶„ì„</p>
            <p class="module-explanation">
                ì—¬ê¸°ëŠ” ìš°ë¦¬ê°€ ë‚˜ëˆˆ ì´ì•¼ê¸°ë¥¼ ìš”ì•½í•˜ê³ , í˜¹ì‹œ ë„¤ ìƒê°ì´ í•œìª½ìœ¼ë¡œë§Œ ê¸°ìš¸ì–´ì§€ì§€ëŠ” ì•Šì•˜ëŠ”ì§€(ì´ê±¸ 'ìƒê° ìŠµê´€'ì´ë¼ê³  ë¶ˆëŸ¬ë³¼ê¹Œ?), ì–´ë–¤ íŠ¹ë³„í•œ ì ì´ ìˆëŠ”ì§€ ì‚´í´ë³´ëŠ” ê³³ì´ì•¼. íŠ¹ë³„í•œ ìƒê° ìŠµê´€ì´ ë³´ì—¬ë„ ê±±ì •í•˜ì§€ ë§ˆ! ëˆ„êµ¬ë‚˜ ê·¸ëŸ´ ìˆ˜ ìˆê³ , ìš°ë¦¬ëŠ” ì´ì•¼ê¸°í•˜ë©´ì„œ í•¨ê»˜ ë” ìœ ì—°í•˜ê²Œ ìƒê°í•˜ëŠ” ë°©ë²•ì„ ì°¾ì„ ìˆ˜ ìˆì–´! ğŸ’ª
            </p>
            <canvas id="situationChart" style="display:none;"></canvas> 
            <div id="situationAlerts" style="margin-top:15px;"></div>
            <button id="continueDistortionTalkBtn" class="action-button" style="display:none;">ì´ ìƒê°ì— ëŒ€í•´ ë‹¤ìŒì— ë” ì´ì•¼ê¸° ë‚˜ëˆ ë³¼ê¹Œ? ğŸ¤”</button>
        </div>

        <p class="footer-assistant-notice">ë³¸ ë¶„ì„ì€ ë¡œì§€ AIê°€ ë§ˆìŒì„ ë‹´ì•„ ì¤€ë¹„í–ˆì–´ìš”.</p>
    </div>

    <script type="module">
        let chartLibraryInitialized = false;

        function initializeChartJsGlobal() {
            try {
                if (typeof Chart !== 'undefined' && Chart) { 
                    Chart.defaults.color = '#333'; 
                    Chart.defaults.borderColor = '#e0e0e0'; 
                    Chart.defaults.font.family = "'KoPub World Dotum', sans-serif"; 
                    Chart.defaults.font.size = 12; 
                    console.log("Analysis Page: Chart.js(UMD) ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¸ì‹ë˜ê³  ê¸°ë³¸ê°’ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    chartLibraryInitialized = true;
                    return true;
                } else {
                    console.error("Analysis Page: Chart.js(UMD) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. <head>ì— ìŠ¤í¬ë¦½íŠ¸ê°€ ì˜¬ë°”ë¥´ê²Œ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
                    const emotionChartContainer = document.getElementById('emotionChartContainer');
                    if (emotionChartContainer) {
                        emotionChartContainer.innerHTML = '<p style="text-align:center; color:red; padding:20px;">ì°¨íŠ¸ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ìˆì–´ìš”. ğŸ˜­<br>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ë³´ì„¸ìš”.</p>';
                    }
                    return false;
                }
            } catch (error) {
                console.error("Analysis Page: Chart.js(UMD) ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜!", error);
                return false;
            }
        }

        document.addEventListener('DOMContentLoaded', () => { 
            console.log("Analysis Page: DOMContentLoaded ì´ë²¤íŠ¸ ì‹œì‘");
            const chartJsIsReady = initializeChartJsGlobal(); 

            const languageAgeSection = document.getElementById('languageAgeSection');
            const realAgeEl = document.getElementById('realAge');
            const predictedLangAgeEl = document.getElementById('predictedLangAge');
            const ageFeedbackEl = document.getElementById('ageFeedback');
            const ageDifferenceVisualEl = document.getElementById('ageDifferenceVisual');
            const languagePracticeBtn = document.getElementById('languagePracticeBtn');
            
            const emotionToneSection = document.getElementById('emotionToneSection');
            const emotionChartEl = document.getElementById('emotionChart');
            const emotionChartContainerEl = document.getElementById('emotionChartContainer');
            const empathyMessageEl = document.getElementById('empathyMessage');
            const tagCloudEl = document.getElementById('tagCloud');
            
            const patternSection = document.getElementById('patternSection');
            const patternDashboardEl = document.getElementById('patternDashboard');
            
            const situationSection = document.getElementById('situationSection');
            const situationAlertsEl = document.getElementById('situationAlerts');
            const continueDistortionTalkBtn = document.getElementById('continueDistortionTalkBtn');
            const situationChartEl = document.getElementById('situationChart');
            
            const reportShareButton = document.getElementById('reportShareButton');
            const containerEl = document.querySelector('.container');

            const userAge = parseInt(localStorage.getItem('lozee_userage'), 10) || 0; 
            if(realAgeEl) realAgeEl.textContent = userAge || "ì •ë³´ ì—†ìŒ";
            console.log("Analysis Page - User Age:", userAge);

            let analysisDataString = localStorage.getItem('lozee_conversation_analysis');
            let analysisResults = null;
            let accumulatedDurationMinutes = 0;
            let accumulatedUserCharCount = 0;

            // --- â­ í•˜ë“œì½”ë”©ëœ ì˜ˆì‹œ ë¶„ì„ ë°ì´í„° (ìš”ì²­ì‚¬í•­ ë°˜ì˜) ---
            // ì‹¤ì œ ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì´ ì˜ˆì‹œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
            const sampleAnalysisForRyan = {
                startTime: Date.now() - (15 * 60 * 1000), // 15ë¶„ ì „ ì‹œì‘í–ˆë‹¤ê³  ê°€ì •
                analysisTime: Date.now(),
                accumulatedDurationMinutes: 15, // 15ë¶„ ëŒ€í™”í–ˆë‹¤ê³  ê°€ì •
                accumulatedUserCharCount: 2500, // 2500ì ëŒ€í™”í–ˆë‹¤ê³  ê°€ì •
                results: {
                    ageLanguageAnalysis: { estimatedAgeRange: "ìê¸° ë‚˜ì´ì™€ ë¹„ìŠ·" }, // ì˜ˆì‹œ: ì‹¤ì œ ë‚˜ì´ì™€ ë¹„ìŠ·
                    emotionToneData: { 'ë‹µë‹µí•¨': 5, 'ë¶„ë…¸': 3, 'ìê¸°ì´í•´': 4, 'ë‹¨í˜¸í•¨': 4, 'í˜¼ë€ìŠ¤ëŸ¬ì›€': 2 }, // ëŒ€í™” ë‚´ìš© ê¸°ë°˜ ê°ì •
                    keywords: ["ê°€ì¡±", "íŒ¨í„´", "íšŒí”¼", "ì•„ìŠ¤í¼ê±°", "ADHD", "ê¸°ì–µë ¥", "íŒë‹¨", "ì†Œì‹œì˜¤íŒ¨ìŠ¤", "ì•ˆì² ìˆ˜"],
                    patterns: [
                        "ë°˜ë³µë˜ëŠ” ë¬¸ì œ ìƒí™©ì— ëŒ€í•œ ëª…í™•í•œ ì¸ì‹ê³¼ í•´ê²° ì˜ì§€",
                        "ìì‹ ì˜ ì‹ ê²½ë‹¤ì–‘ì„± íŠ¹ì„±(ì•„ìŠ¤í¼ê±°, ADHD)ì— ëŒ€í•œ ê¹Šì€ ì´í•´ì™€ ì´ë¥¼ í†µí•œ íƒ€ì¸ ë° ìƒí™© ë¶„ì„",
                        "ë…¼ë¦¬ì ì´ê³  ì§ì„¤ì ì¸ ëŒ€í™” ì„ í˜¸ ë° ë¹„ë…¼ë¦¬/íšŒí”¼ ì„±í–¥ì— ëŒ€í•œ ë¹„íŒì  ì‹œê°"
                    ],
                    cognitiveDistortions: ["ì¼ë°˜í™”ì˜ ì˜¤ë¥˜ (ê°€ëŠ¥ì„±! ğŸ¤«)", "í‘ë°±ë…¼ë¦¬ì  ì‚¬ê³  ê²½í–¥ (ê°€ëŠ¥ì„±! ğŸ¤«)"] // ì˜ˆì‹œ ì¸ì§€ì™œê³¡ (ì§§ì€ ëŒ€í™”ì´ë¯€ë¡œ ê°€ëŠ¥ì„±ìœ¼ë¡œ)
                }
            };
            // ì‹¤ì œ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš© (í…ŒìŠ¤íŠ¸ìš©)
            if (!analysisDataString) {
                console.warn("Analysis Page: localStorageì— ë¶„ì„ ë°ì´í„° ì—†ìŒ. ì˜ˆì‹œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.");
                analysisDataString = JSON.stringify(sampleAnalysisForRyan);
            }
            // --- â­ ì˜ˆì‹œ ë°ì´í„° ë ---


            if (analysisDataString) {
                try {
                    const fullAnalysis = JSON.parse(analysisDataString);
                    analysisResults = fullAnalysis.results;
                    accumulatedDurationMinutes = parseFloat(fullAnalysis.accumulatedDurationMinutes) || 0;
                    accumulatedUserCharCount = parseInt(fullAnalysis.accumulatedUserCharCount, 10) || 0;
                } catch (e) {
                    console.error("ì €ì¥ëœ ë¶„ì„ ê²°ê³¼ íŒŒì‹± ì˜¤ë¥˜:", e);
                    if (containerEl) containerEl.innerHTML = '<h1>ì•—! ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ë¬¸ì œê°€ ìƒê²¼ì–´ìš” ğŸ˜¥</h1><p style="text-align:center;">ì´ì „ ëŒ€í™”ë¡œ ëŒì•„ê°€ê±°ë‚˜, ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
                    return; 
                }
            } else { // ì´ ë¶€ë¶„ì€ ìœ„ì—ì„œ ìƒ˜í”Œ ë°ì´í„°ë¡œ ëŒ€ì²´í–ˆìœ¼ë¯€ë¡œ, ì‹¤ì œë¡œ ë„ë‹¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
                console.warn("Analysis Page: localStorageì— 'lozee_conversation_analysis' ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤ (ì¬í™•ì¸).");
                // ... (ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ ë¡œì§ì€ ìœ„ì—ì„œ ì²˜ë¦¬) ...
                return; 
            }
            
            if (!analysisResults) {
                console.warn("Analysis Page: íŒŒì‹± í›„ analysisResults ê°ì²´ê°€ nullì…ë‹ˆë‹¤.");
                // ... (ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€ ì²˜ë¦¬) ...
                return;
            }

            // --- 1. ì–¸ì–´Â·ë‚˜ì´ ë¶„ì„ ì„¹ì…˜ ì²˜ë¦¬ ---
            if (languageAgeSection) {
                if (userAge > 12 || !analysisResults.ageLanguageAnalysis) { 
                    languageAgeSection.style.display = 'none';
                } else {
                    languageAgeSection.style.display = 'block'; 
                    let predictedText = "ì •ë³´ë¥¼ ëª¨ìœ¼ëŠ” ì¤‘... ğŸ¤”"; // ê¸°ë³¸ê°’
                    if (analysisResults.ageLanguageAnalysis.estimatedAgeRange === "ìê¸° ë‚˜ì´ì™€ ë¹„ìŠ·") {
                        predictedText = `${userAge}ì‚´ ì¹œêµ¬ì™€ ë¹„ìŠ·í•´ìš”!`;
                    } else if (analysisResults.ageLanguageAnalysis.estimatedAgeRange.match(/\d+/)) {
                        predictedText = `${analysisResults.ageLanguageAnalysis.estimatedAgeRange.match(/\d+/)[0]} ì‚´ ì¹œêµ¬ì²˜ëŸ¼ ë§í•´ìš”!`;
                    }
                    
                    let feedbackMsg = ''; 
                    let visualText = ''; 
                    let accuracyIcon = ''; 

                    if(ageFeedbackEl) ageFeedbackEl.className = 'feedback';

                    if (accumulatedUserCharCount >= 7000) { accuracyIcon = ' <span style="color:green; font-weight:bold;">(ë¶„ì„ ì •í™•ë„ ë†’ìŒ! ğŸ‘)</span>';
                    } else if (accumulatedUserCharCount >= 2000) { accuracyIcon = ' <span style="color:blue;">(ê½¤ ì •í™•í•œ ë¶„ì„!)</span>';
                    } else { accuracyIcon = ' <span style="color:#cc7a00;">(ì•„ì§ì€ ê°€ëŠ¥ì„±! ğŸ¤«)</span>'; }

                    if(predictedLangAgeEl) predictedLangAgeEl.innerHTML = `${predictedText}${accuracyIcon}`;

                    if (accumulatedDurationMinutes < 30) {
                        visualText = "(ì•„ì§ 30ë¶„ì´ ì•ˆ ë¼ì„œ, ì‚´ì§ ë§›ë³´ê¸° ë¶„ì„ì´ì•¼! ğŸ³)";
                        feedbackMsg = "ë¡œì§€ì™€ 30ë¶„ ì´ìƒ ì´ì•¼ê¸°í•˜ë©´ ë‚´ê°€ ì–¼ë§ˆë‚˜ ë©‹ì§€ê²Œ ë§í•˜ëŠ”ì§€ ì‚´ì§ ì•Œë ¤ì¤„ê²Œ! ì¡°ê¸ˆë§Œ ë” ì´ì•¼ê¸° ë‚˜ëˆ ë³¼ê¹Œ?";
                        if(ageFeedbackEl) ageFeedbackEl.classList.add('neutral');
                    } else { // 30ë¶„ ì´ìƒ ëŒ€í™” ì‹œ
                        const predictedAgeNum = analysisResults.ageLanguageAnalysis.estimatedAgeRange.match(/\d+/) ? parseInt(analysisResults.ageLanguageAnalysis.estimatedAgeRange.match(/\d+/)[0], 10) : userAge;
                        const diffYearsApprox = userAge - predictedAgeNum;

                        if (accumulatedDurationMinutes < 120) { visualText = `(ë¡œì§€ë‘ ë‚˜ëˆˆ ì´ì•¼ê¸°ë¡œ ë³¸ ì²«ì¸ìƒ! ğŸŒ±)${accuracyIcon}`; /* ... */ } 
                        else if (accumulatedDurationMinutes < 360) { visualText = `(ì´ì•¼ê¸°ë¥¼ ë” ë§ì´ ë‚˜ëˆ ë³´ë‹ˆ ì•Œ ê²ƒ ê°™ì•„! ğŸŒ³)${accuracyIcon}`; /* ... */ } 
                        else { visualText = `(ë¡œì§€ê°€ ë³¸ ë„ˆì˜ ë©‹ì§„ ë§ì†œì”¨! ğŸŒŸ)${accuracyIcon}`; /* ... */ }
                        // ìƒì„¸ í”¼ë“œë°± ë©”ì‹œì§€ (ì´ì „ ì½”ë“œì™€ ìœ ì‚¬í•˜ê²Œ êµ¬ì„±)
                        feedbackMsg = `ë„¤ ë§ì†œì”¨ëŠ” ${predictedText}ì¸ ê²ƒ ê°™ì•„! ${visualText}`; // ì˜ˆì‹œ
                        if(ageFeedbackEl) ageFeedbackEl.classList.add('neutral'); // ë˜ëŠ” ìƒí™©ì— ë§ê²Œ
                        
                        if (userAge <= 12 && diffYearsApprox >= 1) { 
                            if(languagePracticeBtn) languagePracticeBtn.style.display = 'inline-block';
                        } else {
                            if(languagePracticeBtn) languagePracticeBtn.style.display = 'none';
                        }
                    }
                    if(ageDifferenceVisualEl) ageDifferenceVisualEl.innerHTML = visualText;
                    if(ageFeedbackEl) { ageFeedbackEl.textContent = feedbackMsg; ageFeedbackEl.style.display = 'block';}
                    if(languagePracticeBtn && languagePracticeBtn.style.display === 'inline-block') {
                        languagePracticeBtn.onclick = () => alert("ì¬ë¯¸ìˆëŠ” ì–¸ì–´ ì—°ìŠµì„ ì¤€ë¹„í•˜ê³  ìˆì–´! ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì¤˜! ğŸ˜Š");
                    }
                }
            }

            // --- 2. ê°ì • ì–´ì¡° ë° íƒœê·¸ í´ë¼ìš°ë“œ ---
            if (emotionToneSection) {
                if (chartJsIsReady && analysisResults.emotionToneData && Object.keys(analysisResults.emotionToneData).length > 0) {
                    if(emotionChartEl) emotionChartEl.style.display = 'block';
                    if(emotionChartContainerEl && emotionChartContainerEl.querySelector('.no-chart-message')) { emotionChartContainerEl.querySelector('.no-chart-message').remove(); }
                    renderEmotionChart('emotionChart', analysisResults.emotionToneData);
                    if(empathyMessageEl) displayEmpathyMessage(analysisResults.emotionToneData);
                } else { 
                    if(emotionChartEl) emotionChartEl.style.display = 'none';
                    if(emotionChartContainerEl && !emotionChartContainerEl.querySelector('.no-chart-message')) {
                        const noDataMsg = document.createElement('p');
                        noDataMsg.textContent = chartJsIsReady ? "ë¶„ì„ì´ ìŒ“ì´ë©´ ì—¬ê¸°ì— ë§ˆìŒ ìƒ‰ê¹” ì°¨íŠ¸ê°€ ì™„ì„±ë  ê±°ì•¼! ğŸ˜Š" : "ì°¨íŠ¸ ê¸°ëŠ¥ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”. ğŸ˜¥";
                        noDataMsg.style.textAlign = 'center'; noDataMsg.style.color = '#888'; noDataMsg.classList.add('no-chart-message');
                        emotionChartContainerEl.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ë¹„ìš°ê³  ë©”ì‹œì§€ë§Œ
                        emotionChartContainerEl.appendChild(noDataMsg);
                    }
                    if(empathyMessageEl && ! (analysisResults.emotionToneData && Object.keys(analysisResults.emotionToneData).length > 0) ) { empathyMessageEl.textContent = "ì•„ì§ì€ ë„¤ ë§ˆìŒì† ê°ì •ë“¤ì„ ìì„¸íˆ ì•Œê¸° ì–´ë ¤ì›Œ. ë¡œì§€ë‘ ë” ë§ì€ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ ë³´ì!"; empathyMessageEl.className = 'feedback neutral'; empathyMessageEl.style.display = 'block'; }
                }
                if (analysisResults.keywords && analysisResults.keywords.length > 0) {
                    if(tagCloudEl) renderTagCloud('tagCloud', analysisResults.keywords.map(kw => ({ text: kw, weight: 5 + Math.floor(Math.random() * 10) })));
                } else { if(tagCloudEl) tagCloudEl.innerHTML = '<p style="text-align:center; color:#888;">ì´ì•¼ê¸° ì†ì—ì„œ ìì£¼ ë‚˜ì˜¨ ë‹¨ì–´ë“¤ì„ ëª¨ìœ¼ê³  ìˆì–´ìš”!</p>';}
            }
            
            // --- 3. ë°˜ë³µ íŒ¨í„´ ---
            if (patternSection) {
                if (analysisResults.patterns && analysisResults.patterns.length > 0) {
                    if(patternDashboardEl) renderPatternDashboard('patternDashboard', analysisResults.patterns);
                } else { if(patternDashboardEl) patternDashboardEl.innerHTML = '<p style="text-align:center; color:#888;">ë°˜ë³µë˜ëŠ” ì´ì•¼ê¸° íŒ¨í„´ì„ ì°¾ê³  ìˆì–´ìš”!</p>';}
            }

            // --- 4. ìƒí™© ë¶„ì„ (ì¸ì§€ì™œê³¡) ---
            if (situationSection) {
                const situationChartToHide = document.getElementById('situationChart');
                if(situationChartToHide) situationChartToHide.style.display = 'none'; 
                if (analysisResults.cognitiveDistortions && analysisResults.cognitiveDistortions.length > 0) {
                    if(situationAlertsEl) alertCognitiveDistortions('situationAlerts', analysisResults.cognitiveDistortions, accumulatedUserCharCount); // charCount ì „ë‹¬
                    if (continueDistortionTalkBtn) { 
                        continueDistortionTalkBtn.style.display = 'inline-block'; 
                        const accuracyTextForButton = accumulatedUserCharCount < 2000 ? "(ì•„ì§ ì´ì•¼ê¸°ê°€ ì¶©ë¶„í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì–´ìš”)" : (accumulatedUserCharCount < 7000 ? "(ë” ì´ì•¼ê¸°í•˜ë©´ ì •í™•í•´ì ¸ìš”)" : "");
                        continueDistortionTalkBtn.innerHTML = `ì´ ìƒê°ì— ëŒ€í•´ ë‹¤ìŒì— ë” ì´ì•¼ê¸° ë‚˜ëˆ ë³¼ê¹Œ? ğŸ¤” <span style="font-size:0.8em; display:block; color:#eee;">${accuracyTextForButton}</span>`;
                        continueDistortionTalkBtn.onclick = () => { 
                            localStorage.setItem('lozee_continue_topic', JSON.stringify({ 
                                type: 'cognitive_distortion_follow_up', 
                                details: `ë°œê²¬ëœ ìƒê° ìŠµê´€ (${analysisResults.cognitiveDistortions[0] || 'ìì„¸íˆ ë³´ê¸°'})` // ì˜ˆì‹œ
                            })); 
                            alert("ì¢‹ì•„ìš”! ë‹¤ìŒë²ˆì— ë¡œì§€ë¥¼ ë§Œë‚˜ë©´ ì´ ìƒê°ì— ëŒ€í•´ ë” ê¹Šì´ ì´ì•¼ê¸° ë‚˜ëˆ ë´ìš”. ì•½ì†! ğŸ¤™");
                        }; 
                    }
                } else {
                    if(situationAlertsEl) situationAlertsEl.innerHTML = '<p style="text-align:center; color:#888;">íŠ¹ë³„íˆ í•œìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§„ ìƒê° ì—†ì´ ì´ì•¼ê¸°ë¥¼ ì˜ ë‚˜ëˆ„ê³  ìˆêµ¬ë‚˜! ì˜í–ˆì–´! ğŸ‘</p>';
                    if(continueDistortionTalkBtn) continueDistortionTalkBtn.style.display = 'none';
                }
            }

            // ê³µìœ  ë²„íŠ¼ ë¡œì§
            if(reportShareButton) { reportShareButton.onclick = () => { /* ... ê¸°ì¡´ ê³µìœ  ë¡œì§ ... */ }; }
        });

        // --- ë°ì´í„° ë Œë”ë§ í•¨ìˆ˜ë“¤ (ë³¸ë¬¸ ë‚´ìš© í¬í•¨) ---
        function renderTagCloud(elementId, tags) { const cloudEl = document.getElementById(elementId); if(!cloudEl) return; if(tags && tags.length > 0) { cloudEl.innerHTML = tags.map(tag => { const size = 0.8 + (tag.weight / 15); const opacity = Math.max(0.5, tag.weight / 10); return `<span class="badge" style="opacity:${opacity}; font-size:${size}em;">${tag.text}</span>`; }).join(''); } else { cloudEl.innerHTML = '<p style="text-align:center; color:#888;">ì•„ì§ ì£¼ìš” ë‹¨ì–´ê°€ ì¶©ë¶„íˆ ëª¨ì´ì§€ ì•Šì•˜ì–´ìš”.</p>'; } }
        function renderPatternDashboard(elementId, patterns) { const dashEl = document.getElementById(elementId); if(!dashEl) return; if(patterns && patterns.length > 0) { dashEl.innerHTML = patterns.map(p => `<p>ğŸ’¡ ${p}</p>`).join(''); } else { dashEl.innerHTML = '<p style="text-align:center; color:#888;">ë°˜ë³µë˜ëŠ” ì´ì•¼ê¸° íŒ¨í„´ì„ ì°¾ê³  ìˆì–´ìš”!</p>'; } }
        
        function alertCognitiveDistortions(elementId, distortions, charCount = 0) { 
            const alertEl = document.getElementById(elementId); 
            if(!alertEl) return; 
            if(distortions && distortions.length > 0) { 
                let accuracyIconText = '';
                if (charCount < 2000) { accuracyIconText = ' <span style="color:#cc7a00; font-weight:normal; font-size:0.9em;">(ì•„ì§ì€ ê°€ëŠ¥ì„±! ğŸ¤« ë” ì´ì•¼ê¸°í•˜ë©´ ì •í™•í•´ì ¸ìš”!)</span>';
                } else if (charCount < 7000) { accuracyIconText = ' <span style="color:blue; font-weight:normal; font-size:0.9em;">(ê½¤ ì‹ ì¤‘í•œ ë¶„ì„ì´ì—ìš”!)</span>';
                } else { accuracyIconText = ' <span style="color:green; font-weight:bold; font-size:0.9em;">(ì •í™•ë„ ë†’ì€ ë¶„ì„ì´ì—ìš”! ğŸ‘)</span>'; }
                alertEl.innerHTML = distortions.map(d => `<p class="cognitive-distortion-item">${d}${accuracyIconText}</p>`).join(''); 
            } else { 
                alertEl.innerHTML = '<p style="text-align:center; color:#888;">íŠ¹ë³„íˆ í•œìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§„ ìƒê° ì—†ì´ ì´ì•¼ê¸°ë¥¼ ì˜ ë‚˜ëˆ„ê³  ìˆêµ¬ë‚˜! ì˜í–ˆì–´! ğŸ‘</p>';
            } 
        }
        
        function renderEmotionChart(canvasId, emotionData) { /* ... ì´ì „ ë‹µë³€ì˜ ì™„ì„±ëœ ë„ë„› ì°¨íŠ¸ ì½”ë“œ ... */ }
        function displayEmpathyMessage(emotionData) { /* ... ì´ì „ ë‹µë³€ì˜ ì™„ì„±ëœ ê³µê° ë©”ì‹œì§€ ì½”ë“œ ... */ }
        function getKoreanVocativeParticle(name) { /* ... ì´ì „ ë‹µë³€ì˜ ì™„ì„±ëœ í˜¸ê²©ì¡°ì‚¬ ì½”ë“œ ... */ }
    </script>
    <script src="./js/gnb.js" defer></script> 
</body>
</html>